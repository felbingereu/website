var __index = {"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"blog/2025/05/10/nixos-asbr-mit-vrf-zur-separierung-von-egp-und-igp.html","title":"NixOS: ASBR mit VRF zur Separierung von EGP und IGP","text":"<p>In unserem Netzwerk betreiben wir einen ASBR (Autonomous System Boundary Router) auf Basis von NixOS, ifstate und FRRouting. Ziel war es, das EGP (Exterior Gateway Protocol) und das IGP (Interior Gateway Protocol) mittels einer VRF (Virtual Routing and Forwarding) voneinander zu trennen.</p> <p>Der grunds\u00e4tzliche Aufbau wird durch das folgende Schaubild beschrieben:</p> <p></p> <p>Zum Testen der Konfiguration wurde ein Client direkt an den ASBR angebunden. Dieser Client ist Teil des internen Netzwerks, geh\u00f6rt somit zum IGP und ist \u00fcber die Schnittstelle eth0 verbunden, welche der Global Routing Table (GRT bzw. rttable main) zugewiesen ist. In dieser Tabelle wurde eine Default-Route konfiguriert, die den Traffic \u00fcber die VRF public leitet.</p> <p>An die VRF public wiederum sind drei Upstream-Provider angebunden: A, B und C. W\u00e4hrend die Provider A und B jeweils eine vollst\u00e4ndige IPv6-Routingtabelle (auch als Default-Free Zone (DFZ) bekannt) bereitstellen, delegiert Upstream Provider C zus\u00e4tzlich einige IPv4 Adressen in Form eines PA (Provider Aggregatable) Assignment. Anders als die beiden anderen Upstream Provider liefert C jedoch keine vollst\u00e4ndige Routingtabelle, sondern lediglich eine Default-Route per BGP (default-originate).</p> <p>In diesem Blog-Artikel dient die \u00f6ffentliche IPv4 12.34.56.78 als Beispieladresse aus dem delegierten Netzwerk.</p> <p>Nachdem die Implementierung durchgef\u00fchrt wurde, wurde getestet, ob diese wie erwartet funktioniert. Zun\u00e4chst wurde getestet, ob das ASBR selbst mit dem Internet kommunizieren kann:</p> <p><pre><code>[root@asbr:~]# ping -c 1 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=57 time=28.6 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 28.909/28.909/28.909/0.000 ms\n</code></pre> <pre><code>[root@asbr:~]# tcpdump -n -i any icmp\n00:00:00.031238 public Out IP 12.34.56.78 &gt; 1.1.1.1: ICMP echo request, id 3, seq 1, length 64\n00:00:00.031252 eth3  Out IP 12.34.56.78 &gt; 1.1.1.1: ICMP echo request, id 3, seq 1, length 64\n00:00:00.059831 eth3  In  IP 1.1.1.1 &gt; 12.34.56.78: ICMP echo reply, id 3, seq 1, length 64\n</code></pre></p> <p>Nachdem dies erfolgreich war, wurde gepr\u00fcft, ob der Client ebenfalls eine Verbindung aufbauen kann:</p> <p><pre><code>[root@client:~]# ping -c 4 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n\n--- 1.1.1.1 ping statistics ---\n4 packets transmitted, 0 received, 100% packet loss, time 3072ms\n</code></pre> <pre><code>[root@asbr:~]# tcpdump -n -i any icmp\n00:00:00.004049 eth0  In  IP 10.0.0.2 &gt; 1.1.1.1: ICMP echo request, id 53, seq 1, length 64\n00:00:00.004049 eth0  In  IP 10.0.0.2 &gt; 1.1.1.1: ICMP echo request, id 53, seq 2, length 64\n00:00:00.004049 eth0  In  IP 10.0.0.2 &gt; 1.1.1.1: ICMP echo request, id 53, seq 3, length 64\n00:00:00.004049 eth0  In  IP 10.0.0.2 &gt; 1.1.1.1: ICMP echo request, id 53, seq 4, length 64\n</code></pre></p> <p>Wie aus den tcpdump-Ausgaben ersichtlich ist, werden nur die eingehenden ICMP Echo-Requests vom Client protokolliert. Es findet jedoch keine Weiterleitung in der VRF public oder auf dem Interface eth3 (zum Upstream-Provider C) statt.</p> <p>Um das Problem besser untersuchen zu k\u00f6nnen, entschied ich mich einen NixOS Integration Test f\u00fcr das Szenario anzulegen. Im ersten Schritt implementierte ich lediglich IPv6 mit den Upstream Providern A und B, welche uns beide eine Full Table zur Verf\u00fcgung stellen. Nachdem dies funktionierte, f\u00fcgte ich IPv4 und den Upstream Provider C hinzu. Dabei war feststellbar, dass neben IPv4 auch IPv6 nicht mehr funktionierte. Ich versuchte verschiedene Konfigurationen zu implementieren. Irgendwann deaktivierte ich die von Upstream Provider C announcte Default-Route, was dazu f\u00fchrte, dass IPv6 wieder wie gew\u00fcnscht funktionierte.</p> <p>Basierend auf den gewonnenen Erkenntnissen beschlossen wir, die von Upstream-Provider C per BGP announcierte Default-Route herauszufiltern. Dazu modifizierten wir in FRR die Prefix-List, die beim Import der Routen von Provider C greift um das entsprechende Pr\u00e4fix zu blockieren.</p> F\u00fcr IPv4 relevante Ausschnitte der FRR Konfiguration und \u00dcberpr\u00fcfung ob Konfiguration zum gew\u00fcnschten Ergebnis f\u00fchrt  Die erste Zeile sorgt, daf\u00fcr dass die Default Route abgelehnt wird: <pre><code>ip prefix-list import seq 1 deny 0.0.0.0/0\nip prefix-list import seq 2 permit 0.0.0.0/0 le 32\nip prefix-list export seq 1 permit 12.34.56.78/32\nip prefix-list export seq 2 deny 0.0.0.0/0 le 32\n!\nip route 12.34.56.78/32 Null0\n!\nvrf public\n  ip protocol bgp route-map set-src\nexit-vrf\n!\nrouter bgp OWN_ASN vrf public\n  bgp router-id 12.34.56.78\n  no bgp default ipv4-unicast\n  no bgp network import-check\n  neighbor 172.20.20.1 remote-as ASN_UPSTREAM_C\n  !\n  address-family ipv4 unicast\n    network 12.34.56.78/32\n    neighbor 172.20.20.1 activate\n    neighbor 172.20.20.1 remove-private-AS\n    neighbor 172.20.20.1 soft-reconfiguration inbound\n    neighbor 172.20.20.1 prefix-list import in\n    neighbor 172.20.20.1 prefix-list export out\n  exit-address-family\nexit\n!\nroute-map set-src permit 1\n  set src 12.34.56.78\nexit\n</code></pre>  Nachdem die Konfiguration angewandt wurde, kann wie folgt \u00fcberpr\u00fcft werden, ob die Route wie gew\u00fcnscht abgelehnt wird.  Von Upstream Provider C empfangene Routen anzeigen: <pre><code>[root@asbr:~]# vtysh -c 'show ip bgp vrf public neighbors 172.20.20.1 received-routes'\nBGP table version is 2, local router ID is 12.34.56.78, vrf id 7\nDefault local pref 100, local AS OWN_ASN\nStatus codes:  s suppressed, d damped, h history, u unsorted, * valid, &gt; best, = multipath,\n              i internal, r RIB-failure, S Stale, R Removed\nNexthop codes: @NNN nexthop's vrf id, &lt; announce-nh-self\nOrigin codes:  i - IGP, e - EGP, ? - incomplete\nRPKI validation codes: V valid, I invalid, N Not found\n\n    Network          Next Hop            Metric LocPrf Weight Path\n*&gt; 0.0.0.0/0        172.20.20.1                             0 ASN_UPSTREAM_C i\n\nTotal number of prefixes 1 (1 filtered)\n</code></pre>  Die Default-Route wird gefiltert und erscheint daher nicht in den akzeptierten Routen, die in die RIB \u00fcbernommen werden: <pre><code>[root@asbr:~]# vtysh -c 'show ip bgp vrf public neighbors 172.20.20.1 routes'\n</code></pre> <p>Anschlie\u00dfend \u00fcberpr\u00fcften wir die Konnektivit\u00e4t erneut, indem wir vom Client aus gezielt die IPv4-Adresse des Transit-Netzes von Provider C anpingten.</p> Warum sollte das funktionieren?  Das Interface eth3 ist in der VRF public mit einer IPv4-Konfiguration versehen. Da es sich dabei um ein /30er-Netz handelt, wird automatisch eine \"connected\" bzw. Kernel-Route f\u00fcr dieses Subnetz erzeugt. Diese Route ist auch ohne weitere BGP-Routen innerhalb der VRF verf\u00fcgbar und erm\u00f6glicht daher gezielt die Erreichbarkeit der Transit-Adresse des Upstream-Providers.  Routen in FIB f\u00fcr VRF public anzeigen: <pre><code>[root@asbr:~]# ip route show vrf public\n172.20.20.0/30 dev eth3 proto kernel scope link src 172.20.20.2\n</code></pre>  Routen in RIB f\u00fcr VRF public anzeigen: <pre><code>[root@asbr:~]# vtysh -c 'show ip route vrf public'\nCodes: K - kernel route, C - connected, L - local, S - static,\n    R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,\n    T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,\n    F - PBR, f - OpenFabric, t - Table-Direct,\n    &gt; - selected route, * - FIB route, q - queued, r - rejected, b - backup\n    t - trapped, o - offload failure\n\nVRF public:\nL * 12.34.56.78/32 is directly connected, public, 00:00:00\nC&gt;* 12.34.56.78/32 is directly connected, public, 00:00:00\nC&gt;* 172.20.20.0/30 is directly connected, eth3, 00:00:00\nL&gt;* 172.20.20.2/32 is directly connected, eth3, 00:00:00\n</code></pre> <p><pre><code>[root@client:~]# ping -c 1 172.20.20.2\nPING 172.20.20.2 (172.20.20.2) 56(84) bytes of data.\n64 bytes from 172.20.20.2: icmp_seq=1 ttl=63 time=33.3 ms\n\n--- 172.20.20.2 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 33.285/33.285/33.285/0.000 ms\n</code></pre> <pre><code>[root@asbr:~]# tcpdump -n -i any icmp\n00:00:00.730500 eth0  In  IP 10.0.0.2 &gt; 172.20.20.2: ICMP echo request, id 24, seq 19, length 64\n00:00:00.730540 public Out IP 10.0.0.2 &gt; 172.20.20.2: ICMP echo request, id 24, seq 19, length 64\n00:00:00.730567 eth3  Out IP 12.34.56.78 &gt; 172.20.20.2: ICMP echo request, id 24, seq 19, length 64\n00:00:00.746948 eth3  In  IP 172.20.20.2 &gt; 12.34.56.78: ICMP echo reply, id 24, seq 19, length 64\n00:00:00.746991 eth0  Out IP 172.20.20.2 &gt; 10.0.0.2: ICMP echo reply, id 24, seq 19, length 64\n</code></pre></p> <p>Es darf also keine Default Route innerhalb der VRF verwendet werden, da sonst das Forwarding beeintr\u00e4chtigt wird.</p> <p>Ohne Default-Route wird ein Paket vom Client wie folgt durch den ASBR geleitet.</p> <pre><code>[root@asbr:~]# ip rule\n0:      from all lookup local\n1000:   from all lookup [l3mdev-table]\n32766:  from all lookup main\n32767:  from all lookup default\n</code></pre> <p>Zun\u00e4chst greift die <code>lookup local</code>-Policy - diese wird aber \u00fcbersprungen, da das Ziel keine lokale Adresse ist. Auch die Regel <code>lookup [l3mdev-table]</code> wird anfangs \u00fcbersprungen, weil das Paket aus der GRT (IGP) stammt und somit keinen VRF-Kontext hat. Schlie\u00dflich gelangt das Paket zur Regel <code>lookup main</code>. Die FIB der GRT beinhaltet eine Default-Route, die das Paket in die VRF public routet. Innerhalb dieser gibt es eine Connected/Kernel Route, die das Paket \u00fcber eth3 an Upstream Provider C weiterleitet. Dabei wird das Paket ebenfalls auf die \u00f6ffentliche IPv4 Adresse genattet.</p> <p>Eine Default-Route in der FIB der VRF Public sorgt f\u00fcr zwei Probleme:</p> <ol> <li> <p>Aus unbekannten Gr\u00fcnden erfolgt kein Forwarding von Paketen aus der GRT. Auch mittels tcpdump    war nicht nachvollziehbar, ob das Forwarding von der GRT in die VRF public oder von VRF public    zu Upstream Provider C fehlschl\u00e4gt und dies falsch in tcpdump dargestellt wird.</p> </li> <li> <p>Wird ein Paket aus eth3 (Upstream Provider C) empfangen, hat dieses einen VRF Kontext, wodurch    nach der <code>lookup local</code>-Policy die Regel <code>lookup [l3mdev-table]</code> zutrifft. Dadurch wird in der    FIB der VRF public nach einer passenden Route zum Ziel gesucht. Diese wird in Form der    Default-Route gefunden, wodurch das Paket sofort zur\u00fcck zum Upstream Provider C geschickt wird.    Es findet also kein <code>lookup main</code> statt.</p> </li> </ol> <p>Da wir von den delegierten Adressen des Upstream Providers C abh\u00e4ngig sind, musste eine L\u00f6sung f\u00fcr dieses Problem gefunden werden. Da sich diese Abh\u00e4ngigkeit ausschlie\u00dflich auf IPv4 bezieht, wurde zun\u00e4chst die IPv6-BGP-Sitzung deaktiviert. Im Anschluss wurden die notwendigen IPv4-Routen (0.0.0.0/0 ohne Bogon-Pr\u00e4fixe) generiert und statisch in der FIB der VRF public definiert:</p> <pre><code>from netaddr import IPSet\n\nresult = IPSet([\"0.0.0.0/0\"]) - IPSet([\n  \"0.0.0.0/8\",\n  \"10.0.0.0/8\",\n  \"100.64.0.0/10\",\n  \"127.0.0.0/8\",\n  \"169.254.0.0/16\",\n  \"172.16.0.0/12\",\n  \"192.0.0.0/24\",\n  \"192.0.2.0/24\",\n  \"192.168.0.0/16\",\n  \"198.18.0.0/15\",\n  \"198.51.100.0/24\",\n  \"203.0.113.0/24\",\n  \"224.0.0.0/4\",\n  \"240.0.0.0/4\",\n  \"255.255.255.255/32\",\n])\nprint('\\n'.join([str(cidr) for cidr in result.iter_cidrs()]))\n</code></pre> <p>Anschlie\u00dfend funktionierte auch die Kommunikation zwischen Client und Internet:</p> <p><pre><code>[root@client:~]# ping -c 1 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=63 time=35.2 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 33.285/33.285/33.285/0.000 ms\n</code></pre> <pre><code>[root@asbr:~]# tcpdump -n -i any icmp\n00:00:00.730500 eth0  In  IP 10.0.0.2 &gt; 1.1.1.1: ICMP echo request, id 24, seq 19, length 64\n00:00:00.730540 public Out IP 10.0.0.2 &gt; 1.1.1.1: ICMP echo request, id 24, seq 19, length 64\n00:00:00.730567 eth3  Out IP 12.34.56.78 &gt; 1.1.1.1: ICMP echo request, id 24, seq 19, length 64\n00:00:00.746948 eth3  In  IP 1.1.1.1 &gt; 12.34.56.78: ICMP echo reply, id 24, seq 19, length 64\n00:00:00.746991 eth0  Out IP 1.1.1.1 &gt; 10.0.0.2: ICMP echo reply, id 24, seq 19, length 64\n</code></pre></p> <p>Unsere weitere Absicht ist es, bei Upstream Provider C nach einer Full Table zu fragen. Aus meiner Sicht ist die Verwendung von default-originate f\u00fcr ein \u00f6ffentliches Peering grunds\u00e4tzlich unzweckm\u00e4\u00dfig. Der Grund daf\u00fcr ist, dass nur Pakete \u00fcber diese Route geleitet werden, die nicht in den Routing-Tabellen der anderen Provider enthalten sind. K\u00fcrzere Routen, die \u00fcber Provider C verf\u00fcgbar w\u00e4ren, k\u00f6nnen nicht erkannt werden und werden deshalb weiterhin \u00fcber den l\u00e4ngeren Pfad geroutet.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html","title":"NixOS Router: Banana PI R4","text":"<p>Der Banana Pi R4 ist ein leistungsf\u00e4higes und dabei preislich sehr attraktives Netzwerkger\u00e4t, das speziell f\u00fcr anspruchsvolle Anwendungen entwickelt wurde. Ausgestattet mit dem MediaTek MT7988 SoC und bis zu 8 GB DDR4-RAM bietet er eine starke Grundlage f\u00fcr moderne Netzwerkinfrastrukturen. Besonders hervorzuheben sind die beiden integrierten SFP+ Schnittstellen, die High-Speed-Daten\u00fcbertragungen mit bis zu 10 Gbit/s erm\u00f6glichen. Durch die Unterst\u00fctzung von Wi-Fi 6, einem M.2-Steckplatz f\u00fcr NVMe- oder 5G-Module sowie vielseitigen GPIO-Pins ist der BPI-R4 \u00e4u\u00dferst flexibel und erweiterbar.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#verwendung-als-all-in-one-netzwerkgerat","title":"Verwendung als All-In-One Netzwerkger\u00e4t","text":"<p>Der Banana Pi R4 soll in meinem Heimnetz nicht nur die klassische Rolle eines Routers \u00fcbernehmen, sondern sich als vielseitige All-in-One-Netzwerkl\u00f6sung beweisen. Neben grundlegenden Aufgaben wie Routing und Firewalling plane ich den Einsatz als NAT64-Gateway, um IPv6-only Clients den Zugriff auf IPv4-Dienste zu erm\u00f6glichen. Auch als Firewall mit Deep Packet Inspection und einem Intrusion Detection/Prevention System wird das Ger\u00e4t zum zentralen Sicherheitsbaustein.</p> <p>F\u00fcr maximale Flexibilit\u00e4t bei der Konfiguration der Netzwerkschnittstellen setze ich auf ifstate, ein deklaratives Werkzeug zur Netzwerkkonfiguration. Die dynamische Routing-Komponente \u00fcbernimmt FRR, w\u00e4hrend nftables als leistungsstarke Firewall-Engine fungiert. Zus\u00e4tzlich experimentiere ich mit verschiedenen Layer-7-Firewalls und Suricata als IDS/IPS.</p> <p>Auch Dienste wie Knot Resolver/DNS (als rekursiver/autoritativer DNS-Server), Kea f\u00fcr DHCPv4 und DHCPv6-PD, sowie radvd f\u00fcr SLAAC kommen zum Einsatz. Optional plane ich, Asterisk als VoIP-Telefonanlage zu betreiben, um eine vollst\u00e4ndige IP-PBX bereitzustellen.</p> <p>Abgerundet wird das ganze durch LLDP zur Nachbarschaftserkennung sowie diverse Prometheus Metrics Exporters f\u00fcr Monitoring-Zwecke. Ziel ist es, eine robuste, sichere und flexible Plattform zu schaffen, die alle zentralen Netzaufgaben in einem kompakten Ger\u00e4t b\u00fcndelt \u2013 und das auf Basis von NixOS, um alles deklarativ und reproduzierbar zu halten.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#verwandte-arbeiten","title":"Verwandte Arbeiten","text":"<p>F\u00fcr das Vorg\u00e4ngermodell, den Banana Pi R3, gibt es bereits eine gr\u00f6\u00dftenteils funktionale NixOS-Implementierungen. Siehe Router 2023: Part 1, Router 2023: Part 2, Beispielkonfiguration.</p> <p>Mitte 2024 entwickelte sich aus dieser Beispielkonfiguration NixOS SBC - ein Modul explizit f\u00fcr Einplatinencomputer, welches auch die Unterst\u00fctzung des BPI-R4 anstrebt.</p> <p>Unabh\u00e4ngig davon Dokumentierten die Nutzer newAM und K900 ihre eigenen Fortschritte in separaten Git Repositores. Siehe: github:newAM/nixos-bpi-r4, gitlab:k900/nix</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#beschaffung-und-zusammenbau","title":"Beschaffung und Zusammenbau","text":"<p>Die Suche nach einem Anbieter, der die 8-GB-Variante des Banana Pi R4 inklusive Zubeh\u00f6r nach Deutschland liefert, erwies sich als herausfordernd. Letztendlich habe ich mich f\u00fcr folgenden Artikel entschieden: amazon.de/dp/B0F2HZSH3L. Abweichend zur Produktbeschreibung und den Abbildungen wurde anstatt eines US-Netzteils ein EU-Netzteil mitgeliefert.</p> <p></p> <p>Der Zusammenbau gestaltet sich dank der ausf\u00fchrlichen Anleitung unter docs.banana-pi.org/en/BPI-R4/BPI-R4_Accessory_installation \u00e4u\u00dferst einfach und problemlos.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#initialer-start-mit-vorinstalliertem-openwrt","title":"Initialer Start mit vorinstalliertem OpeNWRT","text":"<p>Zwei DIP-Schalter erlauben die Auswahl des Bootmediums. Zun\u00e4chst stellte ich diese auf die Position 01, um vom NAND-Chip zu booten. Auf meinem Board war dort OpenWRT in der Version 21.02 installiert. Der Bootlog kann auf https://felbinger.eu/attachments/bpi-r4-openwrt21-bootlog.txt betrachtet werden.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#nixos-sbc","title":"NixOS SBC","text":""},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#bootstrap-image","title":"Bootstrap Image","text":"<p>Im Anschluss nutzte ich die folgenden Befehle, um das Bootstrap-Image von NixOS SBC auf die SD-Karte zu schreiben: <pre><code>nix build github:nakato/nixos-sbc#sdImages.x86_64-linux.sdImage-bananapi-bpir4\nzstd -d --stdout result/sd-image/nixos-sd-BananaPi-BPiR4-v0.3.raw.zst | sudo dd of=/dev/sdb bs=4M status=progress\n</code></pre> Nach dem Umstellen der DIP-Schalter auf Position 11 startete das Ger\u00e4t NixOS erfolgreich von der SD-Karte.</p> <p>Bereits aus den Logs (https://felbinger.eu/attachments/bpi-r4-nixos-sbc-bootlog.txt) kann entnommen werden, dass anders als beim OpenWRT Image lediglich 4 GB RAM erkannt werden. Nach dem Login mit den Initial-Zugangsdaten (Benutzername: <code>root</code>, Passwort: <code>SBCDefaultBootstrapPassword</code>) best\u00e4tigte sich dies, sowie die Tatsache, dass das WLAN Modul noch nicht erkannt wurde.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#modifikationen","title":"Modifikationen","text":"<p>Der n\u00e4chste Schritt war es, NixOS SBC so anzupassen, dass eine Ver\u00e4nderungen m\u00f6glich waren.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#initialkonfiguration","title":"Initialkonfiguration","text":"<p>Dazu wurde das Repository geklont und zun\u00e4chst um eine Initialkonfiguration \u00e4hnlich der Konfiguration des Bootstrap Images zu erweitern. Dazu wurde die Flake wie folgt erweitert: <pre><code>--- a/flake.nix\n+++ b/flake.nix\n@@ -59,6 +59,13 @@\n                   sbc.bootstrap.initialBootstrapImage = true;\n                   sbc.version = \"0.3\";\n                   nixpkgs.hostPlatform.system = system;\n+\n+                  nix.settings.experimental-features = [\"nix-command\" \"flakes\"];\n+                  services.openssh = {\n+                    enable = true;\n+                    settings.PermitRootLogin = \"yes\";\n+                  };\n+                  users.users.root.password = lib.mkForce \"root\";\n                 }\n               ]\n               ++ (lib.optionals (device ? extraModules) device.extraModules)\n</code></pre></p> <p>Anschlie\u00dfend wurde eine neue SD Karte mit dem Image geflashed: <pre><code>nix build .#sdImages.x86_64-linux.sdImage-bananapi-bpir4\nzstd -d --stdout result/sd-image/nixos-sd-BananaPi-BPiR4-v0.3.raw.zst | sudo dd of=/dev/sdb bs=4M status=progress\n</code></pre></p> <p>Nachdem das System von dieser gestartet wurde, war feststellbar, dass das Passwort auf root gesetzt war und der SSH Login mit dem root-Nutzer m\u00f6glich war.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#8-gb-ram","title":"8 GB RAM","text":"<p>Wie bereits beschrieben, konnte mithilfe des NixOS SBC Bootstrap-Image festgestellt werden, dass lediglich 4 GB Arbeitsspeicher erkannt wurde.</p> <p>In einem Beitrag im Banana Pi Forum fand ich heraus, dass f\u00fcr die Nutzung von 8 GB RAM zwei Bedingungen erf\u00fcllt sein mussten. Zum einen muss die DRAM-Konfiguration (dram_configs.mk) eine AVAIL_DRAM_SIZE von 4096 haben, sodass die Einzelmodule korrekt erkannt werden. Au\u00dferdem muss, w\u00e4hrend des Kompilierens der ATF DDR4_4BG_MODE=1 gesetzt werden.</p> <p>Innerhalb von NixOS SBC wird github:mtk-openwrt/arm-trusted-firmware in einer Version vom M\u00e4rz 2025 eingesetzt. Betrachtet man die seit dem durchgef\u00fchrten \u00c4nderungen, so ist erkennbar, dass Anfang Juli 2025 eine DRAM Konfiguration implementiert wurde.</p> <p>Somit ist ein Update dieses Repositories in NixOS SBC n\u00f6tig. Zusammengefasst lie\u00df sich die Unterst\u00fctzung der 8 GB RAM durch folgenden Patch implementieren: <pre><code>--- a/pkgs/bananaPiR4/default.nix\n+++ b/pkgs/bananaPiR4/default.nix\n@@ -52,7 +52,7 @@\n\n   armTrustedFirmwareMT7988 =\n     (buildArmTrustedFirmware rec {\n-      extraMakeFlags = [\"USE_MKIMAGE=1\" \"DRAM_USE_COMB=1\" \"BOOT_DEVICE=sdmmc\" \"bl2\" \"bl31\"];\n+      extraMakeFlags = [\"USE_MKIMAGE=1\" \"DRAM_USE_COMB=1\" \"DDR4_4BG_MODE=1\" \"BOOT_DEVICE=sdmmc\" \"bl2\" \"bl31\"];\n       platform = \"mt7988\";\n       extraMeta.platforms = [\"aarch64-linux\"];\n       filesToInstall = [\"build/${platform}/release/bl2.img\" \"build/${platform}/release/bl31.bin\"];\n@@ -61,9 +61,9 @@\n       src = fetchFromGitHub {\n         owner = \"mtk-openwrt\";\n         repo = \"arm-trusted-firmware\";\n-        # mtksoc HEAD 2025-03-12\n-        rev = \"e090770684e775711a624e68e0b28112227a4c38\";\n-        hash = \"sha256-VI5OB2nWdXUjkSuUXl/0yQN+/aJp9Jkt+hy7DlL+PMg=\";\n+        # mtksoc HEAD 2025-07-11\n+        rev = \"78a0dfd927bb00ce973a1f8eb4079df0f755887a\";\n+        hash = \"sha256-m9ApkBVf0I11rNg68vxofGRJ+BcnlM6C+Zrn8TfMvbY=\";\n       };\n       version = \"2.12.0-mtk\";\n       nativeBuildInputs = oldAttrs.nativeBuildInputs ++ [dtc ubootTools which python3];\n</code></pre></p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#wireguard","title":"Wireguard","text":"<p>Erst w\u00e4hrend des Einrichtungsprozesses stellte sich heraus, dass keine Wireguard-Interfaces erzeugt werden konnten, da das entsprechende Kernel-Modul nicht gefunden wurde. Dieses Problem l\u00e4sst sich jedoch beheben, indem man die <code>structuredExtraConfig</code> anpasst und Wireguard als Kernelmodul hinzuf\u00fcgt: <pre><code>--- a/pkgs/bananaPiR4/default.nix\n+++ b/pkgs/bananaPiR4/default.nix\n@@ -253,6 +253,30 @@\n\n       XFRM_USER = module;\n       NFT_XFRM = module;\n+\n+      ## WireGuard support ##\n+      WIREGUARD = module;\n+      WIREGUARD_DEBUG = no;\n+\n+      # Network dependencies\n+      NET = yes;\n+      INET = yes;\n+      NET_UDP_TUNNEL = module;\n+      NET_FOU = module;\n+\n+      # Crypto dependencies\n+      CRYPTO = yes;\n+      CRYPTO_BLKCIPHER = yes;\n+      CRYPTO_BLAKE2S = module;\n+      CRYPTO_CHACHA20 = module;\n+      CRYPTO_CHACHA20_NEON = module;\n+      CRYPTO_CURVE25519 = module;\n+      CRYPTO_CURVE25519_NEON = module;\n+      CRYPTO_CHACHA20POLY1305 = module;\n+      CRYPTO_LIB_CHACHA20 = module;\n+      CRYPTO_LIB_POLY1305 = module;\n+      CRYPTO_LIB_CURVE25519 = module;\n+      CRYPTO_LIB_CHACHA20POLY1305 = module;\n     };\n\n     argsOverride = {\n</code></pre></p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#wifi-modul","title":"WiFi Modul","text":"<p>tbd</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#nutzung","title":"Nutzung","text":"<p>Nachdem die vorerst notwendigen Modifikationen am System durchgef\u00fchrt werden, kann dieses genutzt werden. Daf\u00fcr werden die oben beschrieben Komponenten in NixOS deklarativ konfiguriert.</p>"},{"location":"blog/2025/05/31/nixos-router-banana-pi-r4.html#initial-testphase","title":"Initial Testphase","text":"<p>Planung: F\u00fcr den ersten Testeinsatz des Systems wird ein einfaches Client-Netzwerk ohne komplexe Anforderungen angenommen. Dies erm\u00f6glicht eine grundlegende \u00dcberpr\u00fcfung der Funktionalit\u00e4t und Leistungsf\u00e4higkeit des Systems.</p> <p>Netzwerkdiagramm: </p> <p>Konfiguration: Im ersten Schritt wird lediglich eine Basiskonfiguration bestehend aus der ifstate-Schnittstellenkonfiguration, dem Knot Resolver als Recursive DNS Server, einem Kea DHCPv4 Server f\u00fcr das Client-Segment und einer einfachen Firewall mit NAT Funktionalit\u00e4tdurchgef\u00fchrt.</p> Konfiguration des Switching Chips in ifstate 2.0.0 <pre><code>{\n  networking.ifstate.settings.interfaces = {\n    \"br-lan\" = {\n      addresses = [ \"192.168.178.1/24\" ];\n      link = {\n        kind = \"bridge\";\n        state = \"up\";\n      };\n    };\n    lan1 = {\n      link = {\n        state = \"up\";\n        kind = \"dsa\";\n        link = \"end0\";\n        master = \"br-lan\";\n      };\n    };\n    lan2 = {\n      link = {\n        state = \"up\";\n        kind = \"dsa\";\n        link = \"end0\";\n        master = \"br-lan\";\n      };\n    };\n    lan3 = {\n      link = {\n        state = \"up\";\n        kind = \"dsa\";\n        link = \"end0\";\n        master = \"br-lan\";\n      };\n    };\n  };\n}\n</code></pre> <p>Testen: Neben der IPv4 Adressvergabe mittels DHCP, dem DNS Recursor und der NAT wurde prim\u00e4r die Distributed Switch Architecture (DSA), also die korrekte Funktionalit\u00e4t des eingebauten Switching Chips getestet wurde. Hierf\u00fcr kam das Tool iperf zum Einsatz, bei dem 10 GBit Netzwerktraffic zwischen Notebook und Computer mit einer Geschwindigkeit von 1 Gbit/s ohne wesentliche Belastung der CPU des Routers \u00fcbertragen wurden. Das Ergebnis zeigte, dass der Switching-Chip wie erwartet funktioniert.</p> <p>Fortsetzung folgt...</p>"},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html","title":"Linux Game Server Manager: DayZ Server","text":"<p>Ein Bekannter bat mich k\u00fcrzlich, einen DayZ-Server mit dem VPP-Admin-Tool und DeerIsle aufzusetzen. F\u00fcr das Hosting entschied ich mich f\u00fcr einen vServer mit Debian 12 als Basis. Die Installation und Verwaltung des Servers erledigte ich bequem mit dem Tool Linux Game Server Managers (LGSM), das speziell f\u00fcr dedizierte Game-Server unter Linux entwickelt wurde.</p>"},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html#steam-account","title":"Steam Account","text":"<p>F\u00fcr den Download der Serverdateien von Steam wird ein Steam-Account ben\u00f6tigt. \u00dcblicherweise erstellt man daf\u00fcr einen separaten Account, um die eigenen Zugangsdaten nicht zu gef\u00e4hrden \u2013 diese liegen auf dem Server n\u00e4mlich im Klartext.</p> <p>Beim DayZ-Server f\u00fchrt ein solcher \u201efrischer\u201c Account jedoch zu Problemen: Hat der Account DayZ nicht gekauft, wird der Server zwar installiert und gestartet, jedoch unvollst\u00e4ndig \u2013 es fehlen unter anderem die offiziellen Missionen. Dieses Verhalten wurde bereits in Issue #4601 bei LGSM dokumentiert.</p> <p>Zur L\u00f6sung dieses Problems gibt es zwei Ans\u00e4tze:</p> <ol> <li>Die fehlenden Missionen manuell \u00fcber das offizielle    GitHub-Repository von Bohemia Interactive nachladen.</li> <li>Einen Steam-Account verwenden, der DayZ besitzt \u2013 wie es ein    Nutzer ebenfalls vorschl\u00e4gt.</li> </ol> <p>Ich entschied mich f\u00fcr die zweite Variante, um m\u00f6gliche Folgeprobleme zu vermeiden. Daf\u00fcr habe ich meine eigenen Steam-Zugangsdaten tempor\u00e4r auf dem Server hinterlegt. Nachdem ich die bestehenden Serverdateien gel\u00f6scht und den SteamCMD-Login via Steam Guard best\u00e4tigt hatte, wurden alle Dateien \u2013 inklusive der Missionen \u2013 vollst\u00e4ndig heruntergeladen.</p>"},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html#basisinstallation","title":"Basisinstallation","text":"<p><pre><code>apt-get install -y curl jq nano git\n\n# siehe https://linuxgsm.com/servers/dayzserver/\nadduser --disabled-password --gecos \"\" dayzserver\nsu - dayzserver # run cmds seprate\ncurl -Lo linuxgsm.sh https://linuxgsm.sh &amp;&amp; chmod +x linuxgsm.sh &amp;&amp; bash linuxgsm.sh dayzserver\nmkdir -p ~dayzserver/lgsm/config-lgsm/dayzserver/\ncat &lt;&lt;_EOF &gt;&gt; ~dayzserver/lgsm/config-lgsm/dayzserver/secrets-dayzserver.cfg\nsteamuser=\nsteampass=\n_EOF\n./dayzserver install\n</code></pre> Nachdem die erste Ausf\u00fchrung des Install-Befehls, die Verzeichnisstruktur angelegt hat, ist feststellbar, dass diverse Abh\u00e4ngigkeiten nicht installiert sind. Der Einfachste weg diese zu installieren ist es diesen Befehl erneut als root-Nutzer auszuf\u00fchren. Danach erfolgt die eigentliche Serverinstallation als der zuvor angelegte, nicht-privilegierte Benutzer: <pre><code># wieder zur\u00fcck von su shell in root shell\nexit\n~dayzserver/dayzserver install\n\n# anschlie\u00dfend als dayzserver nutzer\nsu - dayzserver\n./dayzserver install\n</code></pre></p> <p>Die Konfiguration des Servers erfolgt in der Datei <code>~dayzserver/serverfiles/cfg/dayzserver.server.cfg</code>. Ich passte zun\u00e4chst folgende Einstellungen direkt per sed an: <pre><code>sed -i \\\n  -e 's|hostname.*|hostname = \"felbinger.eu\";|g' \\\n  -e 's|passwordAdmin.*|passwordAdmin = \"'r4nd0m-s3cr3t'\";|g' \\\n  -e 's|maxPlayers.*|maxPlayers = 10;|g' \\\n  -e 's|disable3rdPerson.*|disable3rdPerson = 1;|g' \\\n  -e 's|disableCrosshair.*|disableCrosshair = 1;|g' \\\n  ~dayzserver/serverfiles/cfg/dayzserver.server.cfg\n</code></pre></p> <p>Nun kann der Server mit dem Befehl <code>./dayzserver start</code> gestartet wurde. Die Konsole des DayZ Servers steht in einer tmux-Session zur Verf\u00fcgung, die vereinfacht mit <code>./dayzserver console</code> ge\u00f6ffnet werden kann.</p> <p>Ich konnte dem Server im Anschluss erfolgreich \u00fcber den DayZ Launcher (unter Servers \u2192 Direct Connection) beitreten.</p>"},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html#mods","title":"Mods","text":""},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html#cf-vppadmintools","title":"CF &amp; VPPAdminTools","text":"<p>Im n\u00e4chsten Schritt stand die Installation der ben\u00f6tigten Mods an. Den Anfang machte das gew\u00fcnschte Admin-Werkzeug: das VPP-Admin-Tool.</p> <p>Die Entwickler stellen im offiziellen Wiki eine ausf\u00fchrliche Anleitung f\u00fcr die Installation und Konfiguration auf dedizierten Servern zur Verf\u00fcgung.</p> <p>Die ben\u00f6tigten Mods \u2013 insbesondere CF (eine Basisabh\u00e4ngigkeit vieler Mods) und VPPAdminTools selbst \u2013 wurden zun\u00e4chst auf dem Client \u00fcber den Steam Workshop heruntergeladen. Anschlie\u00dfend kopierte ich sie manuell auf den Server in das entsprechende serverfiles-Verzeichnis.</p> <pre><code># ls -l ~dayzserver/serverfiles\ntotal 60352\ndrwxr-xr-x 1 dayzserver dayzserver    11900 Aug  6 19:09 addons\n-rwxr-xr-x 1 dayzserver dayzserver      637 Aug  6 19:08 ban.txt\ndrwxr-xr-x 1 dayzserver dayzserver       70 Aug  6 19:09 battleye\ndrwxr-xr-x 1 dayzserver dayzserver       50 Aug  6 19:21 @CF              # &lt;---\ndrwxr-xr-x 1 dayzserver dayzserver       42 Aug  6 19:11 cfg\n-rwxr-xr-x 1 dayzserver dayzserver     1956 Aug  6 19:08 dayz.gproj\n-rwxr-xr-x 1 dayzserver dayzserver 23222512 Aug  6 19:08 DayZServer\n-rwxr-xr-x 1 dayzserver dayzserver     1106 Aug  6 19:08 dayzsetting.xml\ndrwxr-xr-x 1 dayzserver dayzserver       48 Aug  6 19:33 docs\ndrwxr-xr-x 1 dayzserver dayzserver      474 Aug  6 19:09 dta\ndrwxr-xr-x 1 dayzserver dayzserver      144 Aug  6 19:37 keys\n-rwxr-xr-x 1 dayzserver dayzserver   391056 Aug  6 19:08 libsteam_api.so\ndrwxr-xr-x 1 dayzserver dayzserver      120 Aug  6 19:09 mpmissions\ndrwxr-xr-x 1 dayzserver dayzserver       12 Aug  6 19:09 sakhal\n-rwxr-xr-x 1 dayzserver dayzserver     3165 Aug  6 19:08 serverDZ.cfg\ndrwxr-xr-x 1 dayzserver dayzserver      200 Aug  6 19:09 server_manager\n-rwxr-xr-x 1 dayzserver dayzserver        6 Aug  6 19:08 steam_appid.txt\ndrwxr-xr-x 1 dayzserver dayzserver       74 Aug  6 19:09 steamapps\n-rwxr-xr-x 1 dayzserver dayzserver 38156120 Aug  6 19:08 steamclient.so\ndrwxr-xr-x 1 dayzserver dayzserver       50 Aug  6 19:32 @VPPAdminTools    # &lt;---\n-rwxr-xr-x 1 dayzserver dayzserver      766 Aug  6 19:08 whitelist.txt\n</code></pre> <p>Anschlie\u00dfend mussten die Signaturdateien (BIKeys) der verwendeten Mods in das Serververzeichnis kopiert werden. Nur so erkennt der Server die Mods als g\u00fcltig und erlaubt es den Clients, sich mit aktivierten Mods zu verbinden. <pre><code>cp ~dayzserver/serverfiles/@CF/keys/Jacob_Mango_V3.bikey ~dayzserver/serverfiles/keys/\ncp ~dayzserver/serverfiles/@VPPAdminTools/keys/VPP.bikey ~dayzserver/serverfiles/keys/\n</code></pre></p> <p>Zuletzt wurden die Mods dauerhaft in die Serverkonfiguration eingebunden. Daf\u00fcr erg\u00e4nzte ich zun\u00e4chst die <code>dayzserver.cfg</code> im LGSM-Konfigurationsverzeichnis um den entsprechenden mods-Eintrag: <pre><code>cat &lt;&lt;_EOF &gt;&gt; ~dayzserver/lgsm/config-lgsm/dayzserver/dayzserver.cfg\nmods=\"@CF\\;@VPPAdminTools\"\n_EOF\n</code></pre></p> <p>Nach einem Neustart des Servers sollte nun automatisch im Profilverzeichnis unter <code>~dayzserver/.local/share/DayZ Other Profiles/Server</code> die Konfiguration f\u00fcr das VPP-Admin-Tool erstellt werden, die f\u00fcr die weitere Konfiguration entscheidend ist.</p> <p>Da diese Konfigurationsdateien nicht generiert wurden, entschied ich mich, das Profilverzeichnis manuell \u00fcber die Startparameter zu setzen. In diesem Fall musste ich allerdings auch die Mods direkt \u00fcber den -mod-Parameter angeben, da die zuvor gesetzte mods-Variable nicht mehr ausgewertet wurde:</p> <pre><code>cat &lt;&lt;_EOF &gt;&gt; ~dayzserver/lgsm/config-lgsm/dayzserver/dayzserver.cfg\nstartparameters=\"-ip=${ip} -port=${port} -config=${servercfgfullpath} -profiles=profiles -mod=@CF\\;@VPPAdminTools -servermod=${servermods} -bepath=${bepath} -limitFPS=60 -dologs -adminlog -freezeCheck\"\n_EOF\n# mods variable is no longer in use\nsed -i '/mods.*/d' ~dayzserver/lgsm/config-lgsm/dayzserver/dayzserver.cfg\n</code></pre> <p>Nachdem ich mit <code>mkdir ~dayzserver/serverfiles/profiles</code> das Verzeichnis erstellt hatte und den Server neu startete, wurden die Konfigurationsdateien f\u00fcr das VPP-Admin-Tool wie erwartet generiert. Um einen Spieler als Administrator einzutragen, wird dessen SteamID64 ben\u00f6tigt. Diese l\u00e4sst sich auf zwei Wegen ermitteln:</p> <ol> <li>W\u00e4hrend der Spieler dem Server beitritt, erscheint seine Steam-ID im Server-Log.</li> <li>Alternativ kann die ID \u00fcber steamidfinder.com aus dem Steam-Benutzernamen    oder der Profil-URL ermittelt werden. Die ben\u00f6tigte ID steht im Feld steamID64.</li> </ol> <p>Mehrere Administratoren k\u00f6nnen definiert werden, indem in der Datei <code>SuperAdmins.txt</code> pro Zeile eine Steam-ID eingetragen wird. Au\u00dferdem ist ein Passwort erforderlich, das die berechtigten Nutzer beim \u00d6ffnen des Tools im Spiel eingeben m\u00fcssen.</p> <p><pre><code>echo adminUid &gt; ~dayzserver/serverfiles/profiles/VPPAdminTools/Permissions/SuperAdmins/SuperAdmins.txt\necho adm1n-s3cr3t &gt; ~dayzserver/serverfiles/profiles/VPPAdminTools/Permissions/credentials.txt\n</code></pre> Nach einem weiteren Neustart des Servers (<code>~dayzserver/dayzserver restart</code>) konnte das VPP-Admin-Tool im Spiel wie erwartet verwendet werden \u2013 nach Eingabe des festgelegten Passworts hatte der konfigurierte Benutzer Zugriff auf alle administrativen Funktionen.</p>"},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html#deerisle","title":"DeerIsle","text":"<p>Der DeerIsle Mod wurde ebenfalls vom Client heruntergeladen und in das Verzeichnis <code>~dayzserver/serverfiles/@DeerIsle</code> hochgeladen. Die beiden ben\u00f6tigten Signing Keys kopierte ich anschlie\u00dfend mit: <pre><code>cp ~dayzserver/serverfiles/@DeerIsle/keys/* ~dayzserver/serverfiles/keys/\n</code></pre></p> <p>In der Serverkonfiguration <code>~dayzserver/lgsm/config-lgsm/dayzserver/dayzserver.cfg</code> wurden die \"startparameters\" entsprechend angepasst, um den Mod zus\u00e4tzlich zu laden (<code>-mod=@CF\\;@VPPAdminTools\\;@DeerIsle</code>).</p> <p>Um die eigentliche Mission zu installieren, klonte ich das offizielle Repository, verschob die Missionsdatei und passte die Serverkonfiguration an: <pre><code>git clone https://github.com/johnmclane666/Deerisle-Stable\nmv Deerisle-Stable/V5.9/empty.deerisle ~dayzserver/serverfiles/mpmissions\nrm -r Deerisle-Stable\nsed -i 's/template.*/template = \"empty.deerisle\";/' ~dayzserver/serverfiles/cfg/dayzserver.server.cfg\n</code></pre></p> <p>Damit war die DeerIsle-Mission auf dem Server einsatzbereit.</p>"},{"location":"blog/2025/08/07/linux-game-server-manager-dayz-server.html#spawn-loadout","title":"Spawn-Loadout","text":"<p>Abschlie\u00dfend wurde die Mission so angepasst, dass das Spawn-Loadout der Spieler ver\u00e4ndert wird. Dazu wurde die unten stehende C-Funktion in der Datei <code>~dayzserver/serverfiles/mpmission/empty.deerisle/init.c</code> modifiziert. <pre><code>  override void StartingEquipSetup(PlayerBase player, bool clothesChosen)\n  {\n    player.RemoveAllItems();\n\n    // Military Uniform and Boots\n    EntityAI boots, knife;\n    player.GetInventory().CreateInInventory(\"TTsKOJacket_Camo\");\n    player.GetInventory().CreateInInventory(\"TTSKOPants\");\n    player.GetInventory().CreateInInventory(\"TacticalGloves_Green\");\n    boots = player.GetInventory().CreateInInventory(\"MilitaryBoots_Brown\");\n    knife = boots.GetInventory().CreateInInventory(\"CombatKnife\");\n    player.SetQuickBarEntityShortcut(knife, 3); // Add to quick bar\n\n    // Tactial helmet with nvg and flashlight\n    //EntityAI helmet, helmetAttachment;\n    //helmet = player.GetInventory().CreateInInventory(\"Mich2001Helmet\");\n    //helmetAttachment = helmet.GetInventory().CreateAttachment(\"UniversalLight\");\n    //helmetAttachment.GetInventory().CreateAttachment(\"Battery9V\");\n    //helmetAttachment = helmet.GetInventory().CreateAttachment(\"NVGoggles\");\n    //helmetAttachment.GetInventory().CreateAttachment(\"Battery9V\");\n\n    // Belt with knife and fully equipped pistol\n    EntityAI belt, beltHolster, beltPistol, beltPistolAttachment;\n    belt = player.GetInventory().CreateInInventory(\"MilitaryBelt\");\n    belt.GetInventory().CreateInInventory(\"Canteen\");\n    //beltHolster = belt.GetInventory().CreateInInventory(\"NylonKnifeSheath\");\n    //beltHolster.GetInventory().CreateInInventory(\"CombatKnife\");\n    beltHolster = belt.GetInventory().CreateInInventory(\"PlateCarrierHolster\");\n    beltPistol = beltHolster.GetInventory().CreateInInventory(\"Glock19\");\n    player.SetQuickBarEntityShortcut(beltPistol, 1); // Add to quick bar\n    beltPistol.GetInventory().CreateAttachment(\"Mag_Glock_15Rnd\");\n    //beltPistol.GetInventory().CreateAttachment(\"PistolSuppressor\");\n    //beltPistolAttachment = beltPistolAttachment.GetInventory().CreateAttachment(\"FNP45_MRDSOptic\");\n    //beltPistolAttachment.GetInventory().CreateAttachment(\"Battery9V\");\n    //beltPistolAttachment = beltPistolAttachment.GetInventory().CreateAttachment(\"TLRLight\");\n    //beltPistolAttachment.GetInventory().CreateAttachment(\"Battery9V\");\n    player.GetInventory().CreateInInventory(\"Mag_Glock_15Rnd\");\n    player.GetInventory().CreateInInventory(\"Ammo_9x19\");\n\n    // Plate carrier\n    //EntityAI vest, pouches, vestHolster, vestPistol;\n    //vest = player.GetInventory().CreateInInventory(\"PlateCarrierVest\");\n    //vestHolster = vest.GetInventory().CreateAttachment(\"PlateCarrierHolster\");\n    //vestPistol = vestHolster.GetInventory().CreateInInventory(\"Magnum\");\n    //player.SetQuickBarEntityShortcut(vestPistol, 2); // Add to quick bar\n    //pouches = vest.GetInventory().CreateAttachment(\"PlateCarrierPouches\");\n    //pouches.GetInventory().CreateInInventory(\"Ammo_357\");\n\n    player.GetInventory().CreateInInventory(\"BandageDressing\");\n    player.GetInventory().CreateInInventory(\"BandageDressing\");\n\n    EntityAI itemEnt;\n    string chemlightArray[] = {\n      \"Chemlight_White\",\n      \"Chemlight_Yellow\",\n      \"Chemlight_Green\",\n      \"Chemlight_Red\"\n    };\n    int rndIndex = Math.RandomInt( 0, 4 );\n    itemEnt = player.GetInventory().CreateInInventory( chemlightArray[rndIndex] );\n    SetRandomHealth( itemEnt );\n\n    float rand = Math.RandomFloatInclusive( 0.0, 1.0 );\n    if ( rand &lt; 0.35 )\n      itemEnt = player.GetInventory().CreateInInventory( \"Apple\" );\n    else if ( rand &gt; 0.65 )\n      itemEnt = player.GetInventory().CreateInInventory( \"Pear\" );\n    else\n      itemEnt = player.GetInventory().CreateInInventory( \"Plum\" );\n    SetRandomHealth( itemEnt );\n  }\n</code></pre> Die verwendeten Classnames f\u00fcr die Items k\u00f6nnen online eingesehen werden, beispielsweise hier.</p>"},{"location":"blog/2025/08/27/grapheneos-gmx-freephone-esim-einrichten.html","title":"GrapheneOS: GMX FreePhone eSIM einrichten","text":"<p>GrapheneOS ist ein alternatives Android-Betriebssystem, das auf ausgew\u00e4hlten Pixel-Ger\u00e4ten l\u00e4uft und besonderen Wert auf Sicherheit und Datenschutz legt. Viele Nutzer setzen es ein, um die volle Kontrolle \u00fcber ihr Ger\u00e4t zu behalten und gleichzeitig von Googles Diensten m\u00f6glichst unabh\u00e4ngig zu sein.</p> <p>GMX ist eigentlich vor allem als E-Mail-Anbieter bekannt, bietet inzwischen aber auch Mobilfunktarife an. Einer davon ist GMX FreePhone, ein f\u00fcr 12 Monate kostenloser Basistarif mit 3 GB Datenvolumen pro Monat. Wichtig zu wissen: es gibt nur eine eSIM, keine klassische Plastikkarte.</p> <p>Um den FreePhone Tarif zu testen, habe ich mir einen Account bei GMX angelegt. Zur Verifizierung der eigenen Identit\u00e4t ist eine Telefonnummer erforderlich. Nach dem Login in der GMX Mail App kann der FreePhone Vertrag abgeschlossen werden. Kurze Zeit sp\u00e4ter erhielt ich eine E-Mail mit dem Betreff \"Ihr GMX FreePhone Vertrag: Aktivieren Sie jetzt Ihre eSIM\". Diese beinhaltet Anweisungen f\u00fcr das weitere Vorgehen, den Nutzernamen f\u00fcr den Online-Zugang sowie einen Link f\u00fcr die Aktivierung in folgender Form: <code>https://service.freephone.gmx.net/myData/eSimActivation?tkn=...</code></p> <p>Nach Installation der GMX FreePhone App, versuchte ich mich mit dem Aktivierungslink in der App anzumelden. Dies funktionierte leider nicht. Ich entschied mich, die \"Passwort vergessen\" Funktion zu nutzen um mir ein neues Passwort zuschicken zu lassen. Hierf\u00fcr war eine Angabe des Nutzernamens sowie der PLZ erforderlich. Nachdem ich eine E-Mail mit dem Betreff: \"Ihr neues Passwort f\u00fcr die Servicewelt\" mit dem neuen Passwort erhalten habe, war der Login m\u00f6glich.</p> <p>Direkt nach dem Login tauchte dann auch wie erwartet der Punkt \"eSIM Aktivierung\" auf.</p> <p></p> <p></p> <p>Surfen \u00fcber LTE/5G ist direkt m\u00f6glich. Der erstbeste Speedtest ergibt etwa 10 MBit/s im Download. Der volle Funktionsumfang des Tarifs kann nach der Zustellung des Aktivierungscodes per Post und Eingabe in der App genutzt werden.</p> <p></p> <p>Schlussbemerkungen: Meine Absicht war es zu testen, ob eSIMs prinzipiell unter GrapheneOS funktionieren. Meines Kenntnisstandes nach ist die Aktivierung von eSIMs unter GrapheneOS inzwischen auch ohne Google Play Services im Hauptprofil m\u00f6glich. F\u00fcr die Nutzung des GMX-FreePhone-Tarifs ist jedoch die oben genannte App erforderlich. Da ich diese lediglich \u00fcber den Google Play Store beziehen konnte, war ihre Installation notwendig. Die Aktivierung der eSIM mit der GMX-App unter einem anderen Nutzer war nicht m\u00f6glich.</p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html","title":"Aufsetzen eines Knot Resolvers","text":"<p>Letztes Wochenende habe ich auf einem System Knot Resolver ausgerollt. Meine Absicht war es, einen dnsmasq zu ersetzen, um DNS over TLS (DoT) zu implementieren. dnsmasq hatte in meinem Setup mehrere Funktionen: dnsmasq \u00fcberschieb bestimmte Adressen, blockierte Werbung und leitete bestimmte Zonen an andere DNS-Server weiter. Knot Resolver sollte all diese Aufgaben \u00fcbernehmen.</p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#was-ist-knot-resolver","title":"Was ist Knot Resolver","text":"<p>Knot Resolver ist ein moderner, hochgradig anpassbarer rekursiver DNS-Resolver, der f\u00fcr Flexibilit\u00e4t und Sicherheit entwickelt wurde. Er bietet Features wie DNS over TLS (DoT), DNS over HTTPS (DoH), Caching, Policy-basiertes Routing und eine Lua-Skript-Engine zur individuellen Anpassung. Im Gegensatz zu dnsmasq, das prim\u00e4r als lokaler DNS-Cache f\u00fcr kleine Netzwerke gedacht ist, ist Knot Resolver leistungsf\u00e4higer und bietet erweiterte Debugging- und Routing-M\u00f6glichkeiten.</p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#einrichtung","title":"Einrichtung","text":"<p>Im folgenden wird nun Schritt f\u00fcr Schritt die alte dnsmasq Konfiguration ersetzt: <pre><code>{\n  services.dnsmasq = {\n    enable = true;\n    resolveLocalQueries = true;\n    alwaysKeepRunning = true;\n    settings = {\n      no-hosts = true;\n      no-resolv = true;\n      server = [\n        \"1.1.1.1\"\n        \"1.0.0.1\"\n        \"8.8.8.8\"\n        \"8.8.4.4\"\n        \"2606:4700:4700::1111\"\n        \"2606:4700:4700::1001\"\n        \"2001:4860:4860::8888\"\n        \"2001:4860:4860::8844\"\n\n        \"/example.net/10.20.40.2\"\n        \"/example.org/10.20.40.2\"\n        \"/example.net/10.20.40.3\"\n        \"/example.org/10.20.40.3\"\n        \"/example.de/10.20.35.1\"\n      ];\n      address = [\n        \"/notebook.example.com/10.20.30.100\"\n      ];\n      # block known ads\n      \"conf-file\" = builtins.fetchurl {\n        url = \"https://raw.githubusercontent.com/notracking/hosts-blocklists/master/dnsmasq/dnsmasq.blacklist.txt\";\n        sha256 = \"sha256:1v2jmwv0887i3civmh06s6bzrbkvr78m3icdr8dhy4aq75km6k1k\";\n      };\n    };\n  };\n}\n</code></pre></p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#dns-over-tls","title":"DNS over TLS","text":"<p>Folgende Regeln implementieren DoT <pre><code>policy.add(policy.all(policy.TLS_FORWARD({\n  {'1.1.1.1', hostname='one.one.one.one'},\n  {'1.0.0.1', hostname='one.one.one.one'},\n  {'2606:4700:4700::1111', hostname='one.one.one.one'},\n  {'2606:4700:4700::1001', hostname='one.one.one.one'},\n\n  {'8.8.8.8', hostname='dns.google'},\n  {'8.8.4.4', hostname='dns.google'},\n  {'2001:4860:4860::8888', hostname='dns.google'},\n  {'2001:4860:4860::8844', hostname='dns.google'},\n})))\n</code></pre> Hierf\u00fcr muss knot-resolver ausgehenden Traffic \u00fcber Port tcp/853 senden d\u00fcrfen.</p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#adblocking","title":"AdBlocking","text":"<pre><code>let\n  adblock-rpz = builtins.fetchurl {\n    url = \"https://raw.githubusercontent.com/hagezi/dns-blocklists/main/rpz/multi.txt\";\n    sha256 = \"sha256:1qvac9rkypdqc3mrz33mpqhzk1vhcj00dqbjhs43vd009nxm2pal\";\n  };\nin ''\n  policy.add(policy.rpz(policy.DENY_MSG('Blocked Ads'), '${adblock-rpz}', false))\n'';\n</code></pre>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#uberschreiben-einzelner-adressen","title":"\u00dcberschreiben einzelner Adressen","text":"<pre><code>policy.add(policy.domains(policy.ANSWER(\n  { [kres.type.A] = { rdata=kres.str2ip('10.20.30.100') } }\n), { todname('notebook.example.com') }))\n</code></pre>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#weiterleiten-von-dns-anfragen-an-anderen-nameserver","title":"Weiterleiten von DNS Anfragen an anderen Nameserver","text":"<p>Nach m\u00f6glichkeit sollte immer <code>policy.FORWARD</code> verwendet werden, um DNSSEC zu validieren: <pre><code>policy.add(policy.suffix(policy.FORWARD({'10.20.40.2', '10.20.40.3'}), policy.todnames({'example.net', 'example.org'})))\npolicy.add(policy.suffix(policy.STUB('10.20.35.1'), {todname('example.de')}))\n</code></pre></p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#zusammengefasst-als-nix-konfiguration","title":"Zusammengefasst als Nix Konfiguration","text":"<pre><code>{\n  services.kresd = {\n    enable = true;\n    listenPlain = [\n      \"127.0.0.1:53\"\n      \"[::1]:53\"\n      \"10.20.30.1:53\"\n    ];\n    listenTLS = [\n      # internal DoT listener\n      \"10.20.30.1:853\"\n    ];\n    extraConfig =\n      let\n        adblock-rpz = builtins.fetchurl {\n          url = \"https://raw.githubusercontent.com/hagezi/dns-blocklists/main/rpz/multi.txt\";\n          sha256 = \"sha256:1qvac9rkypdqc3mrz33mpqhzk1vhcj00dqbjhs43vd009nxm2pal\";\n        };\n      in\n      ''\n        -- certificates for internal DoT listener, will be aquired via acme (out of scope for this blog entry)\n        net.tls(\"/var/lib/acme/router.example.com/fullchain.pem\", \"/var/lib/acme/router.example.com/key.pem\")\n\n        -- handle internal domains\n        policy.add(policy.suffix(policy.FLAGS({'NO_CACHE'}), policy.todnames({\n          'example.net',\n          'example.org',\n          'example.de',\n        })))\n        policy.add(policy.suffix(policy.FORWARD({'10.20.40.2', '10.20.40.3'}), policy.todnames({'example.net', 'example.org'})))\n        -- zone not signed using dnssec yet\n        policy.add(policy.suffix(policy.STUB('10.20.35.1'), {todname('example.de')}))\n\n        -- rewrite internal hosts\n        policy.add(policy.domains(policy.ANSWER(\n          { [kres.type.A] = { rdata=kres.str2ip('10.20.30.100') } }\n        ), { todname('notebook.example.com') }))\n\n        -- block known ads using rpz\n        policy.add(policy.rpz(policy.DENY_MSG('Blocked Ads'), '${adblock-rpz}', false))\n\n        -- forward everything else to the public dns servers over dns over tls\n        policy.add(policy.all(policy.TLS_FORWARD({\n          {'1.1.1.1', hostname='one.one.one.one'},\n          {'1.0.0.1', hostname='one.one.one.one'},\n          {'2606:4700:4700::1111', hostname='one.one.one.one'},\n          {'2606:4700:4700::1001', hostname='one.one.one.one'},\n\n          {'8.8.8.8', hostname='dns.google'},\n          {'8.8.4.4', hostname='dns.google'},\n          {'2001:4860:4860::8888', hostname='dns.google'},\n          {'2001:4860:4860::8844', hostname='dns.google'},\n        })))\n      '';\n  };\n}\n</code></pre>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#debugging","title":"Debugging","text":"<p>W\u00e4hrend der Einrichtung hatte ich mehrfach Probleme, dass Regeln nicht die erw\u00fcnschte Wirkung erzielten. Folgende Regeln k\u00f6nnen hinzugef\u00fcgt werden um die Anfragen zu Loggen: <pre><code>policy.add(policy.all(policy.DEBUG_ALWAYS))\n</code></pre> Da diese Regel das Debugging f\u00fcr alle Anfragen aktiviert, und sehr viele Logeintr\u00e4ge produziert, ist es sinnvoller, das Logging auf eine bestimmte Zone zu beschr\u00e4nken: <pre><code>policy.add(policy.suffix(policy.DEBUG_ALWAYS, policy.todnames({'example.net'})))\n</code></pre></p>"},{"location":"blog/2025/03/10/aufsetzen-eines-knot-resolvers.html#besondere-stolperfall-policytodnames-vs-todnames","title":"Besondere Stolperfall: <code>policy.todnames</code> vs. <code>todnames</code>","text":"<p>Einige Funktionen erwarten, dass alle Domainnamen als Tabelle \u00fcbergeben werden, w\u00e4hrend andere f\u00fcr einzelne Domains auch einen String akzeptieren (siehe Dokumentation).</p> <p>Wird eine Tabelle als \u00dcbergabeparameter (wie beispielsweise bei  <code>policy.suffix(action, suffix_table)</code>) erwartet, muss diese mit <code>policy.todnames({'example.net'})</code> oder <code>{ todname('example.net') }</code> generiert werden.</p>"},{"location":"blog/2025/01/30/nixos-erstellen-eines-neuen-pakets.html","title":"NixOS: Erstellen eines neuen Pakets","text":"<p>Dieser Artikel entstand, weil ein Bekannter mich bat, ihm zu zeigen, wie man eine Software f\u00fcr Nix paketiert und in github.com/nixos/nixpkgs integriert. Konkret ging es um das Paket <code>alertmanager-gotify-bridge</code>, das eine Br\u00fccke zwischen dem Prometheus Alertmanager und Gotify bildet. Ziel war es, nicht nur das Paket zu erstellen, sondern auch den gesamten Prozess zu verstehen, um es sp\u00e4ter selbstst\u00e4ndig in das offizielle nixpkgs-Repository einzubringen. Um diesen Ablauf f\u00fcr andere nachvollziehbar zu machen, entschied ich mich, ihn umfassend zu dokumentieren.</p> <ol> <li> <p>Vorarbeiten</p> <ul> <li> <p>Contributing Guide lesen</p> </li> <li> <p>GitHub Account anlegen</p> </li> <li> <p>Fork von  erstellen <li> <p>Fork klonen und offizielles Repository als \"upstream\" hinzuf\u00fcgen (f\u00fcr sp\u00e4teres rebasen):   <pre><code>git remote add upstream git@github.com:nixos/nixpkgs.git\n</code></pre></p> </li> <li> <p>Neuen Feature-Branch in Fork erstellen:     Da die NixOS-Maintainer den master-Branch aufgrund von GitHub-Schutzmechanismen nicht bearbeiten k\u00f6nnen -     insbesondere, weil GitHub Action Workflows dort direkt ausgef\u00fchrt w\u00fcrden - ist es sinnvoll, einen neuen     Feature-Branch zu erstellen.</p> <p>Dies hilft auch dabei, m\u00f6gliche Merge-Konflikte zu l\u00f6sen, besonders wenn man noch nicht viel Erfahrung im Umgang mit Git hat.</p> <pre><code>git checkout -b alertmanager-gotify-bridge\n</code></pre> </li> <li> <p>Sofern dies die erste Contribution zu <code>nixpkgs</code> ist, sollte anschlie\u00dfend ein Eintrag in der Datei     <code>maintainers/maintainers-list.nix</code> angelegt werden.     <pre><code>&lt;handle&gt; = {\n  # Required\n  name = \"Your name\";\n\n  # Optional, but at least one of email, matrix or githubId must be given\n  email = \"address@example.org\";\n  matrix = \"@user:example.org\";\n  github = \"&lt;github-name&gt;\";\n  githubId = your-github-id; # see profile -&gt; profile picture -&gt; url\n\n  keys = [{\n    fingerprint = \"AAAA BBBB CCCC DDDD EEEE  FFFF 0000 1111 2222 3333\";\n  }];\n};\n</code></pre>     Anschlie\u00dfend werden die \u00c4nderungen hinzugef\u00fcgt:     <pre><code>git add maintainers/maintainers-list.nix\ngit commit -m \"maintainers: add &lt;handle&gt;\"\n</code></pre></p> </li> <li> <p>Software analysieren: Programmiersprache und Lizenz bestimmen:     Nix bietet eine Vielzahl von Modulen zur Unterst\u00fctzung unterschiedlicher Programmiersprachen. Daher ist     der erste Schritt, die Programmiersprache der Software zu identifizieren. Sobald die Sprache bestimmt ist,     kann man sich im Language Framework der     NixOS-Dokumentation weiter informieren, um das passende Build-Modul auszuw\u00e4hlen und zu verstehen, wie man     es korrekt in das Paket integriert.</p> <p>Die Lizenz wird im weiteren Verlauf f\u00fcr die Metainformationen des Pakets ben\u00f6tigt.</p> <p>Im Fall der <code>alertmanager-gotify-bridge</code> handelt es sich um eine Go-Anwendung, die unter der Apache-2.0 Lizenz steht. Zum Paketieren von Go-Anwendungen bietet Nix das Modul <code>buildGoModule</code>. Die Lizenz kann mit <code>lib.licenses.asl20</code> definiert werden (siehe lib/licenses.nix).</p> </li> <li> <p>Unter Verwendung des Beispielaufrufes von <code>buildGoModule</code> und der Informationen aus dem GitHub Repositories     der Anwendung kann die Derrivation definiert werden:     <pre><code>{\n lib,\n buildGoModule,\n fetchFromGitHub,\n}:\nbuildGoModule rec {\n  pname = \"alertmanager-gotify-bridge\";  # name of the package\n  version = \"2.3.1\";  # version of last release (on github)\n\n  src = fetchFromGitHub {\n    owner = \"DRuggeri\";  # github owner\n    repo = \"alertmanager_gotify_bridge\";  # github repository name\n    tag = \"v${version}\";  # releases use semver schema for versioning\n    hash = lib.fakeHash;  # we don't know the hash yet, so let's use a fake one\n  };\n\n  vendorHash = lib.fakeHash;\n\n  meta = {\n    description = \"Bridge between Prometheus AlertManager and a Gotify server\";\n    homepage = \"https://github.com/DRuggeri/alertmanager_gotify_bridge\";\n    changelog = \"https://github.com/DRuggeri/alertmanager_gotify_bridge/releases/tag/v${version}\";\n    license = lib.licenses.asl20;\n    maintainers = with lib.maintainers; [ &lt;handle&gt; ];\n  };\n}\n</code></pre>     Nachdem diese unter dem Pfad <code>pkgs/by-name/al/alertmanager-gotify-bridge/package.nix</code> gespeichert wurde,     kann das Programm mithilfe des Befehls <code>nix build -f . alertmanager-gotify-bridge</code> gebaut werden.</p> <p>Beim ersten Ausf\u00fchren wurde der Build jedoch abgebrochen, da Nix einen Fehler im Zusammenhang mit dem <code>src.hash</code>-Attribut erkennt: <pre><code>error: hash mismatch in fixed-output derivation '/nix/store/9v7c1qjzibbq3r4v579h684zgkbg0nkz-source.drv':\n  specified: sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\n     got:    sha256-yXPOrpkhQUNPg5YNBxsgGijT1utRcUZ1k38T7wmkbgg=\nerror: 1 dependencies of derivation '/nix/store/zafjqknp6vq3lrh1lf4y9h1npim3vzz6-alertmanager-gotify-bridge-2.3.1.drv' failed to build\n</code></pre></p> <p>Auch nachdem der korrekte Hash in <code>src.hash</code> eingetragen und der Build erneut gestartet wurde, bricht Nix den Build-Prozess ab, da der <code>vendorHash</code> ebenfalls falsch ist: <pre><code>error: hash mismatch in fixed-output derivation '/nix/store/gx9qq67fn953xyzfgznz4ygh9p1rirbc-alertmanager-gotify-bridge-2.3.1-go-modules.drv':\n  specified: sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\n     got:    sha256-YDSKSSMTdjROyBaiOO2tZtu9QPKSUqwAd8VWf3ZOvDI=\nerror: 1 dependencies of derivation '/nix/store/pgrywjs655jqkn2p11hg8hg7nh835m1f-alertmanager-gotify-bridge-2.3.1.drv' failed to build\n</code></pre></p> <p>Nachdem auch dieser korrigiert ist schlug der Build mit folgender Fehlermeldung fehl: <pre><code>error: builder for '/nix/store/q8751wvq5fnrlr8d0h1dlpdihn2jclcv-alertmanager-gotify-bridge-2.3.1.drv' failed with exit code 1;\n   last 25 log lines:\n   &gt; vendor/golang.org/x/exp/constraints/constraints.go:49:2: embedding interface element Integer | Float | ~string requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &gt; # go.opentelemetry.io/otel/internal/attribute\n   &gt; vendor/go.opentelemetry.io/otel/internal/attribute/attribute.go:26:17: type parameter requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &gt; vendor/go.opentelemetry.io/otel/internal/attribute/attribute.go:26:19: embedding interface element bool | int64 | float64 | string requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &gt; vendor/go.opentelemetry.io/otel/internal/attribute/attribute.go:26:59: predeclared any requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &gt; vendor/go.opentelemetry.io/otel/internal/attribute/attribute.go:34:14: type parameter requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &gt; vendor/go.opentelemetry.io/otel/internal/attribute/attribute.go:34:16: embedding interface element bool | int64 | float64 | string requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &gt; vendor/go.opentelemetry.io/otel/internal/attribute/attribute.go:34:51: predeclared any requires go1.18 or later (-lang was set to go1.16; check go.mod)\n   &lt;... SNIP ...&gt;\n   For full logs, run 'nix log /nix/store/q8751wvq5fnrlr8d0h1dlpdihn2jclcv-alertmanager-gotify-bridge-2.3.1.drv'.\n</code></pre></p> <p>Um diesen Fehler zu beheben, musste die in der <code>go.mod</code> definierten Go-Version aktualisiert werden. Dazu wurde  zun\u00e4chst geforked und geklont. Nachdem die Version in der <code>go.mod</code> auf 1.18 gesetzt wurde, kann der Befehl <code>go mod tidy</code> ausgef\u00fchrt werden, um die indirekten Abh\u00e4ngigkeiten in <code>go.mod</code>, und die dazugeh\u00f6rigen Hashes in der <code>go.sum</code>, hinzuzuf\u00fcgen. <p>Danach wurde mithilfe von <code>git diff</code> ein Patch f\u00fcr die beiden Dateien angelegt, der in der Derrivation hinzugef\u00fcgt werden kann: <pre><code>patches = [ ./go.sum.patch ./go.mod.patch ];\n</code></pre></p> <p>Nachdem das Programm erneut gebaut wurde und der <code>vendorHash</code> aktualisiert wurde, ist der Build erfolgreich. <pre><code>{\n  lib,\n  buildGoModule,\n  fetchFromGitHub,\n}:\nbuildGoModule rec {\n  pname = \"alertmanager-gotify-bridge\";\n  version = \"2.3.1\";\n\n  src = fetchFromGitHub {\n    owner = \"DRuggeri\";\n    repo = \"alertmanager_gotify_bridge\";\n    tag = \"v${version}\";\n    hash = \"sha256-yXPOrpkhQUNPg5YNBxsgGijT1utRcUZ1k38T7wmkbgg=\";\n  };\n  patches = [ ./go.sum.patch ./go.mod.patch ];\n\n  vendorHash = \"sha256-APFoNLCrSiAoeuVIzlnmtUthyqFDcG0cjoJf/jGbrTg=\";\n\n  meta = {\n    description = \"A bridge between Prometheus AlertManager and a Gotify server\";\n    homepage = \"https://github.com/DRuggeri/alertmanager_gotify_bridge\";\n    changelog = \"https://github.com/DRuggeri/alertmanager_gotify_bridge/releases/tag/v${version}\";\n    license = lib.licenses.asl20;\n    maintainers = with lib.maintainers; [ &lt;handle&gt; ];\n  };\n}\n</code></pre></p> <li> <p>Testen und erstellen des Pull Requests     Die resultierende <code>alertmanager_gotify_brudge</code> Binary ist im Verzeichnis <code>result</code> zu finden.</p> <p>Nun kann die <code>package.nix</code> sowie die beiden Patches <code>go.{mod,sum}</code> zur Staging Umgebung hinzugef\u00fcgt, commited und gepushed werden. <pre><code>git add pkgs/by-name/al/alertmanager-gotify-bridge/\ngit commit -m \"alertmanager-gotify-bridge: init at 2.3.1\"\ngit push -u origin alertmanager-gotify-bridge\n</code></pre></p> <p>Zuletzt wird der Pull Request erstellt (siehe Nachricht von <code>git push</code>) und gepr\u00fcft, ob die Pakete alle kompilieren: <pre><code>nix-shell -p nixpkgs-review --run \"nixpkgs-review rev HEAD --print-result\"\n</code></pre></p> </li>"},{"location":"blog/2025/02/15/nixos-cherry-picken-von-commits.html","title":"NixOS: Cherry-Picken von Commits","text":"<p>Wenn man an nixpkgs arbeitet oder einen Pull Request testet, m\u00f6chte man oft nicht einfach auf den Master-Branch wechseln, nur um die \u00c4nderungen aus diesem PR zu testen. Stattdessen ist es oft sinnvoller, die notwendigen Commits direkt in die eigene Version von nixpkgs zu \u00fcbernehmen. So kann man spezifische \u00c4nderungen testen, ohne die gesamte Umgebung auf den neuesten Stand zu bringen. Besonders praktisch ist das, wenn man mit einer stabilen Version von nixpkgs arbeitet, etwa einem Release-Branch, und nur gezielt bestimmte Commits aus einem PR \u00fcbernehmen m\u00f6chte.</p> <p>Um die Version von nixpkgs, die in deinem System verwendet wird, herauszufinden, f\u00fchrst du den Befehl <code>jq -r .nodes.nixpkgs.locked.rev flake.lock</code> aus. Dieser gibt dir die genaue Revision zur\u00fcck, die in deiner flake.lock definiert ist. Danach klonst du nixpkgs und checkst die entsprechende Revision aus: <code>git checkout &lt;rev&gt;.</code>.</p> <p>F\u00fcr die Verwendung deiner lokalen Version von nixpkgs hast du zwei Optionen. Eine M\u00f6glichkeit ist, bei jedem Aufruf des nix-Befehls die Option <code>--override-input nixpkgs path:/path/to/nixpkgs</code> zu verwenden. Alternativ kannst du die flake.nix bearbeiten, die Input-URL auf <code>git+file:/path/to/nixpkgs/</code> setzen und anschlie\u00dfend <code>nix flake update nixpkgs</code> ausf\u00fchren. Wird deploy-sh verwendet, ist letztere Methode erforderlich, da derzeit keine M\u00f6glichkeit der Weitergabe von Optionen an Nix besteht.</p> <p>Wenn du nun dein System baust, sollte nichts gebaut werden m\u00fcssen, da die verwendete Version von nixpkgs gleich geblieben ist.</p> <p>Falls die Commits nicht in einem anderen Branch liegen, sondern du z. B. einen PR testen m\u00f6chtest, musst du zun\u00e4chst den Branch des PR-Autors fetchen: <pre><code>git remote add &lt;autor&gt; &lt;repo_url&gt;\ngit fetch &lt;autor&gt;\n</code></pre></p> <p>Nun kannst du die ben\u00f6tigten Commits in dein lokales nixpkgs \u00fcbernehmen: <pre><code>git cherry-pick &lt;commit-hash&gt;\n</code></pre></p>"},{"location":"blog/2025/02/15/warum-ich-nixos-nutze.html","title":"Warum ich NixOS nutze","text":"<p>Mein Weg zu NixOS war keine spontane Entscheidung, sondern das Ergebnis jahrelanger Erfahrungen mit verschiedenen Linux-Distributionen. Ich habe fr\u00fch angefangen, alternative Betriebssysteme auszuprobieren, und hatte immer den Anspruch, mein System m\u00f6glichst effizient, stabil und flexibel zu gestalten. Doch erst mit NixOS habe ich eine L\u00f6sung gefunden, die meine Anforderungen wirklich erf\u00fcllt.</p> <p>Wie viele andere bin ich mit klassischen Linux-Distributionen gestartet. Zun\u00e4chst nutzte ich Linux Mint, weil es eine benutzerfreundliche Umgebung bot und einen einfachen Einstieg in die Linux-Welt erm\u00f6glichte. Sp\u00e4ter wechselte ich zu Fedora, um Erfahrung im Bereich von RHEL-\u00e4hnlichen Systemen zu erlangen. Beide Systeme haben gut funktioniert, aber mit der Zeit wurde mir bewusst, dass traditionelle Paketmanager und Konfigurationsans\u00e4tze einige Schw\u00e4chen haben - insbesondere in Bezug auf Reproduzierbarkeit und Wartbarkeit.</p> <p>Um meine Systeme dennoch effizient einrichten zu k\u00f6nnen, schrieb ich in dieser Zeit Post-Install-Skripte. Diese erm\u00f6glichten es mir, nach einer frischen Installation schnell alle ben\u00f6tigten Programme, Konfigurationen und Anpassungen vorzunehmen. Dies sparte mir viel Zeit, war aber dennoch nicht ideal, da es immer wieder Anpassungen und manuelle Eingriffe erforderte.</p> Post-Install Skript f\u00fcr Fedora <pre><code>#!/bin/bash\n\n###############################\n##                           ##\n##   Configuration Section   ##\n##                           ##\n###############################\nDNF_PACKAGES=(\n  ## required packages for this post install script ##\n  dnf-plugins-core\n  distribution-gpg-keys\n  ImageMagick\n  terminator                                           # splitable terminal\n  timeshift\n  ## end of required packages ##\n\n  keepassxc                                            # kdbx compatible password manager\n  syncthing\n  sqlitebrowser                                        # simple browser for sqlite databases\n  remmina remmina-plugins-{vnc,rdp,www,spice,secret}   # remote access\n  squashfs-tools\n  VirtualBox\n  audacity\n  vlc                                                  # videolan: vlc media player\n  totem                                                # gnome video player\n  gimp\n  flameshot                                            # tool to create and modify screenshots\n  binwalk                                              # tool to analyse binary files for embeded files and executable code\n  nmap\n  gobuster                                             # directory and vhost enumeration\n  wireshark\n  texlive-scheme-full\n  texstudio\n  kubernetes-client\n  ansible\n\n  # yubikey utilities\n  yubikey-personalization-gui\n  yubikey-manager-qt\n  yubico-piv-tool\n\n  code                                                 # visual studio code using microsoft repo\n  anydesk                                              # using anydesk (rhel) repo\n  teamviewer                                           # using teamviewer repo\n  brave-browser                                        # using brave repo\n  signal-desktop                                       # from dnf copr\n  android-tools\n\n  gnome-tweaks\n  gnome-extensions-app\n  file-roller nemo-fileroller\n  nemo                                                 # install nemo, so we have an alternative to nautilus\n  nemo-seahorse                                        # nemo seahorse integration (sign / encrypt)\n  xed\n)\nFLATPAK_PACKAGES=(\n  im.riot.Riot                                         # Element Client\n  com.spotify.Client\n  org.ferdium.Ferdium\n  org.gtk.Gtk3theme.Adwaita-dark\n)\n\n###################################\n##                               ##\n##   Create Repo Files Section   ##\n##                               ##\n###################################\nmkdir -p /tmp/repos.d\ncat &lt;&lt;_EOF &gt;&gt; /tmp/repos.d/anydesk.repo\n[anydesk]\nname=AnyDesk RHEL - stable\nbaseurl=http://rpm.anydesk.com/rhel/x86_64/\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://keys.anydesk.com/repos/RPM-GPG-KEY\n_EOF\ncat &lt;&lt;_EOF &gt;&gt; /tmp/repos.d/teamviewer.repo\n[teamviewer]\nname=TeamViewer - \\$basearch\nbaseurl=https://linux.teamviewer.com/yum/stable/main/binary-\\$basearch/\ngpgkey=https://linux.teamviewer.com/pubkey/currentkey.asc\ngpgcheck=1\nrepo_gpgcheck=1\nenabled=1\ntype=rpm-md\n_EOF\ncat &lt;&lt;_EOF &gt;&gt; /tmp/repos.d/vscode.repo\n[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc\n_EOF\n\n#################################\n##                             ##\n##   Install Package Section   ##\n##                             ##\n#################################\nsudo dnf update -y --refresh\n\n# add fusion repositories\nsudo dnf install -y \\\n  https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm \\\n  https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm\n\n## check if packages in configuration, which require pre install commands ##\n[[ ${DNF_PACKAGES[@]} =~ \"code\" ]] &amp;&amp; (\n  sudo mv /tmp/repos.d/vscode.repo /etc/yum.repos.d/vscode.repo\n  sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc\n)\n\n[[ ${DNF_PACKAGES[@]} =~ \"anydesk\" ]] &amp;&amp; (\n  sudo mv /tmp/repos.d/anydesk.repo /etc/yum.repos.d/anydesk.repo\n  sudo rpm --import https://keys.anydesk.com/repos/RPM-GPG-KEY\n)\n\n[[ ${DNF_PACKAGES[@]} =~ \"teamviewer\" ]] &amp;&amp; (\n  sudo mv /tmp/repos.d/teamviewer.repo /etc/yum.repos.d/teamviewer.repo\n  sudo rpm --import https://linux.teamviewer.com/pubkey/currentkey.asc\n)\n\n[[ ${DNF_PACKAGES[@]} =~ \"brave-browser\" ]] &amp;&amp; (\n  sudo dnf config-manager --add-repo https://brave-browser-rpm-release.s3.brave.com/x86_64/\n  sudo rpm --import https://brave-browser-rpm-release.s3.brave.com/brave-core.asc\n)\n\n[[ ${DNF_PACKAGES[@]} =~ \"signal-desktop\" ]] &amp;&amp; (\n  sudo dnf config-manager --add-repo https://download.opensuse.org/repositories/network:im:signal/Fedora_37/network:im:signal.repo\n  sudo rpm --import https://download.opensuse.org/repositories/network:/im:/signal/Fedora_37/repodata/repomd.xml.key\n)\n\n## install additional software ##\nsudo dnf install -y ${DNF_PACKAGES[@]}\n\n[[ ${#FLATPAK_PACKAGES[@]} -ne 0 ]] &amp;&amp; (\n  sudo dnf install -y flatpak\n  sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo\n  sudo flatpak install -y flathub\n  sudo flatpak install -y ${FLATPAK_PACKAGES[@]}\n)\n\nwhich ansible &amp;&gt; /dev/null &amp;&amp; ansible-galaxy collection install community.general vyos.vyos\n\n# install drawio (won't update automaticly!)\ncurl -s https://api.github.com/repos/jgraph/drawio-desktop/releases/latest | grep browser_download_url | grep '\\.rpm' | cut -d '\"' -f 4 | wget -O /tmp/drawio.rpm -i -\nsudo yum install -y /tmp/drawio.rpm\nsudo rm /tmp/drawio.rpm\n\n# add password generator script\nsudo wget -q https://raw.githubusercontent.com/felbinger/scripts/master/genpw.sh -O /usr/local/bin/genpw\nsudo chmod +x /usr/local/bin/genpw\n\n# start jetbrains-toolbox to install idea, pycharm and clion\ncurl -s -L -o- $(curl -s \"https://data.services.jetbrains.com/products?code=TBA\"  | jq -r '.[0].releases | .[0].downloads.linux.link') | tar xzC /tmp\n/tmp/jetbrains-toolbox*/jetbrains-toolbox\n\n# change ps1\necho \"PS1='\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[00m\\]\\$ '\" | sudo tee -a /{root,home/${USER}}/.bashrc &amp;&gt; /dev/null\n\n# add your user to some groups for applications\n[[ ${DNF_PACKAGES[@]} =~ \"VirtualBox\" ]] &amp;&amp; sudo usermod -aG vboxusers ${USER}\nsudo usermod -aG dialout ${USER}\n\n###############################################\n##                                           ##\n##   Configure Desktop Environment Section   ##\n##                                           ##\n###############################################\n\n# use nemo as file manager (instead of gnomes default: nautilus)\nxdg-mime default nemo.desktop inode/directory application/x-gnome-saved-search\n\n# install gnome shell extensions\nextensions=(\n  # \"https://extensions.gnome.org/extension/2890/tray-icons-reloaded/\"\n  \"https://extensions.gnome.org/extension/3843/just-perfection/\"\n  \"https://extensions.gnome.org/extension/615/appindicator-support/\"\n)\nfor extension in \"${extensions[@]}\"; do\n  extensionId=$(curl -s $extension | grep -oP 'data-uuid=\"\\K[^\"]+')\n  versionTag=$(curl -Lfs \"https://extensions.gnome.org/extension-query/?search=${extensionId}\" | jq '.extensions[0] | .shell_version_map | map(.pk) | max')\n  wget -qO /tmp/${extensionId}.zip \"https://extensions.gnome.org/download-extension/${extensionId}.shell-extension.zip?version_tag=${versionTag}\"\n  gnome-extensions install --force /tmp/${extensionId}.zip\n  # warning: requires user interaction!\n  if ! gnome-extensions list | grep --quiet ${extensionId}; then\n      busctl --user call org.gnome.Shell.Extensions /org/gnome/Shell/Extensions org.gnome.Shell.Extensions InstallRemoteExtension s ${extensionId}\n  fi\n  gnome-extensions enable ${extensionId}\n  rm /tmp/${extensionId}.zip\ndone\n\n# load schemas of installed extensions into gsettings schema database\nfind ~/.local/share/gnome-shell/extensions/ -type f -name '*.gschema.xml' \\\n  -exec sudo cp {} /usr/share/glib-2.0/schemas/ \\;\nsudo glib-compile-schemas /usr/share/glib-2.0/schemas/\n\n# gsettings set org.gnome.shell.extensions.trayIconsReloaded icon-padding-horizontal 0\n# gsettings set org.gnome.shell.extensions.trayIconsReloaded icon-margin-horizontal  0\n# gsettings set org.gnome.shell.extensions.trayIconsReloaded icons-limit 8\n\ngsettings set org.gnome.shell.extensions.just-perfection activities-button false\ngsettings set org.gnome.shell.extensions.just-perfection world-clock false\ngsettings set org.gnome.shell.extensions.just-perfection weather false\ngsettings set org.gnome.shell.extensions.just-perfection window-menu-take-screenshot-button false\ngsettings set org.gnome.shell.extensions.just-perfection startup-status 0\n\ngsettings set org.gnome.desktop.wm.preferences button-layout 'appmenu:minimize,maximize,close'\ngsettings set org.gnome.desktop.interface show-battery-percentage true\ngsettings set org.gnome.desktop.interface enable-hot-corners false\ngsettings set org.gnome.shell.app-switcher current-workspace-only true\n\n# set background images for screensaver and desktop to static color (#150936)\npath=~/Pictures/background.png\nconvert -size 100x100 'xc:#150936' ${path}\ngsettings set org.gnome.desktop.background picture-uri-dark \"file://${path}\"\ngsettings set org.gnome.desktop.background picture-uri \"file://${path}\"\ngsettings set org.gnome.desktop.screensaver picture-uri \"file://${path}\"\n\n# adjust terminator configuration\ngsettings set org.gnome.desktop.default-applications.terminal exec terminator\ngsettings set org.cinnamon.desktop.default-applications.terminal exec terminator  # required for nemo (right click -&gt; open terminal) to work properly\ngsettings set org.gnome.desktop.default-applications.terminal exec-arg ''\nmkdir -p ~/.config/terminator\ncat &lt;&lt;_EOF &gt;&gt; ~/.config/terminator/config\n[global_config]\n[keybindings]\n[profiles]\n  [[default]]\n    background_color = \"#241f31\"\n    background_darkness = 0.95\n    cursor_color = \"#aaaaaa\"\n    show_titlebar = False\n    scrollbar_position = hidden\n    scrollback_infinite = True\n[layouts]\n  [[default]]\n    [[[window0]]]\n      type = Window\n      parent = \"\"\n    [[[child1]]]\n      type = Terminal\n      parent = window0\n[plugins]\n_EOF\n\ngsettings set org.gnome.desktop.interface gtk-theme 'Adwaita-dark'\ngsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'\n\ngsettings set org.gnome.desktop.interface clock-show-weekday true\ngsettings set org.gnome.desktop.interface clock-show-seconds true\ngsettings set org.gnome.desktop.datetime automatic-timezone true\ngsettings set org.gnome.desktop.calendar show-weekdate true\n\ngsettings set org.gnome.desktop.peripherals.touchpad tap-to-click true\ngsettings set org.gnome.desktop.peripherals.touchpad natural-scroll false\n\n# add keybinds, see https://askubuntu.com/questions/597395/how-to-set-custom-keyboard-shortcuts-from-terminal\ngsettings set org.gnome.settings-daemon.plugins.media-keys custom-keybindings \"['/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/']\"\n\n# disable help keybind\ngsettings set org.gnome.settings-daemon.plugins.media-keys help \"[]\"\n\n# CTRL + ALT + T -&gt; CMD: terminator\ngsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/ name 'Terminal'\ngsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/ command 'terminator'\ngsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/ binding '&lt;Control&gt;&lt;Alt&gt;t'\n\n# CTRL + SHIFT + S -&gt; CMD: flameshot gui\ngsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/ name 'Snapshot'\ngsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/ command 'flameshot gui'\ngsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/ binding '&lt;Shift&gt;&lt;Control&gt;s'\n\n# Super + E -&gt; Launchers/Home folder\ngsettings set org.gnome.settings-daemon.plugins.media-keys home \"['&lt;Super&gt;e']\"\n\n# configure autostart\npaths=(\n  \"/usr/share/applications/syncthing-start.desktop\"\n  \"/usr/share/applications/signal-desktop.desktop\"\n  \"/var/lib/flatpak/app/org.ferdium.Ferdium/x86_64/stable/fbca90383214fa94cf7721471902e3ec7b8222dbe7e532b71a9b607c445af2ae/export/share/applications/org.ferdium.Ferdium.desktop\"\n  \"/var/lib/flatpak/app/im.riot.Riot/x86_64/stable/9bd0c958912a8187b019b3a11260da2e6c241b92a6e570fd0efc8b2f53186310/export/share/applications/im.riot.Riot.desktop\"\n)\nfor path in ${paths[@]}; do\n  cp ${path} ~/.config/autostart/\ndone\nchmod +x ~/.config/autostart/*.desktop\n\n# download profile picture for the user\ncurl -s -L -o ~/Pictures/profile.png https://avatars.githubusercontent.com/u/26925347\n\n# start \"gnome on xorg\" instead of wayland\nsudo sed -i 's/Session=gnome/Session=gnome-xorg/' /var/lib/AccountsService/users/${USER}\n\n##############################\n##                          ##\n##   Remove Logos Section   ##\n##                          ##\n##############################\n# remove fedora logo from gdm\nxhost +si:localuser:gdm\nsudo -u gdm gsettings set org.gnome.login-screen logo ''\n\n# remove fedora logo from plymouth and regenerate initramfs\nsudo cp /usr/share/plymouth/themes/spinner/watermark.png{,.bak}\nsudo convert -size 128x32 xc:transparent /usr/share/plymouth/themes/spinner/watermark.png\nsudo cp /boot/initramfs-$(uname -r).img{,.bak}\nsudo dracut -f /boot/initramfs-$(uname -r).img\n\n\n### CLEANUP\nrm -r /tmp/repos.d\nrm -r /tmp/jetbrains-toolbox*\nrm -r ~/Public\nrm -r ~/Templates\nsudo dnf remove -y nautilus gnome-text-editor\n</code></pre> <p>Auch auf meinen Servern war Automatisierung ein wichtiges Thema. Ich setzte lange auf Debian, da es Stabilit\u00e4t, lange Support-Zyklen und eine gro\u00dfe Community bot. Doch auch hier gab es Herausforderungen: manuelle Konfigurations\u00e4nderungen, Paketkonflikte und Updates, die sich nicht immer problemlos durchf\u00fchren lie\u00dfen. Zudem w\u00fcnschte ich mir eine einfachere M\u00f6glichkeit, meine Server-Setups zu dokumentieren und konsistent zu halten.</p> <p>Anfangs setzte ich auch hier Post-Install-Skripte ein, um meine Systemstruktur gem\u00e4\u00df einem Admin-Guide, den ich mit Freunden erarbeitet hatte, einzurichten. Zur Verwaltung und Konfiguration meiner Server griff ich sp\u00e4ter auf Ansible zur\u00fcck, um \u00c4nderungen zentral zu steuern und auszurollen. Allerdings brachte das eine wesentliche Herausforderung mit sich: Ansible ber\u00fccksichtigt meist nur den aktuellen Zustand des Systems. Manuelle \u00c4nderungen durch Administratoren wurden entweder nicht erkannt oder von sp\u00e4teren Playbook-L\u00e4ufen \u00fcberschrieben, was oft zu unerwarteten Problemen f\u00fchrte. Das System wurde dadurch nicht aus einer fest definierten Ausgangslage heraus neu aufgebaut, sondern lediglich schrittweise modifiziert - ein grundlegender Unterschied zu NixOS. Um die Installation der Maschinen zu automatisieren diente eine Preseed-Konfiguration.</p> Debian Post-Install Skript gem\u00e4\u00df Admin-Guide Struktur <pre><code>#!/bin/bash\n\n## CONFIGURATION ###\nADM_NAME='admin'\nADM_GID=997\nADM_HOME='/home/admin'\nADM_USERS=('user')\n\ndeclare -A STACKS=(\\\n  [\"main\"]=\"172.30.100.0/24\"\n  [\"comms\"]=\"172.30.101.0/24\"\n  [\"storage\"]=\"172.30.102.0/24\"\n)\n\ndeclare -A HELPER=(\\\n  [\"proxy\"]=\"172.30.0.0/24\" \\\n  [\"database\"]=\"172.30.1.0/24\" \\\n  [\"monitoring\"]=\"172.30.2.0/24\"\n)\n### END of CONFIGURATION ###\n\nfunction create_compose() {\n  cp resources/docker-compose.template.yml ${1}\n  # stack network\n  echo -e \"    external:\" &gt;&gt;${compose}\n  echo -e \"      name: ${name}\" &gt;&gt;${compose}\n\n  # define helper networks\n  for helper_name in ${!HELPER[@]}; do\n    echo -e \"  ${helper_name}:\" &gt;&gt;${compose}\n    echo -e \"    external:\" &gt;&gt;${compose}\n    echo -e \"      name: ${helper_name}\" &gt;&gt;${compose}\n  done\n}\n\n# require root privileges\nif [[ $(/usr/bin/id -u) != \"0\" ]]; then\n  echo \"Please run the script as root!\"\n  exit 1\nfi\n\nif [[ ${RERUN} == 1 ]]; then\n  echo \"You already ran the script, if you really want to run the script again set 'RERUN=0'. (This might break your system!)\"\n  exit 1\nfi\n\n# add rerun=1 variable to prevent postinstall to be executed multiple times\nsed -i '2 i\\RERUN=1' ${0}\n\necho \"&gt;&gt;&gt; Installing Software\"\napt-get update\napt-get install sudo curl wget borgbackup\n\n# install docker if not already installed\nif [[ -z $(which docker) ]]; then\n  curl https://get.docker.com | bash\nfi\n\n# install docker-compose if not already installed\nif [[ -z $(which docker-compose) ]]; then\n  curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n  chmod +x /usr/local/bin/docker-compose\nfi\n\n# remove trailing slash from ADM_HOME\n[[ \"${ADM_HOME}\" == */ ]] &amp;&amp; ADM_HOME=\"${ADM_HOME::-1}\"\n\n# create admin group, add members to group and set permissions\necho \"&gt;&gt;&gt; Creating Admin Setup\"\n/usr/sbin/groupadd -g ${ADM_GID} ${ADM_NAME}\nmkdir ${ADM_HOME}\nchown -R root:${ADM_NAME} ${ADM_HOME}\nchmod -R 775 ${ADM_HOME}\nfor user in ${ADM_USERS[@]}; do\n  # check if user exists\n  if [ ! $(sed -n \"/^${user}/p\" /etc/passwd) ]; then\n    /usr/sbin/useradd --create-home --shell=/bin/bash ${user}\n  fi\n  /usr/sbin/usermod --append --groups=sudo,${ADM_NAME} ${user}\n\n  # add aliases\n  echo -e '\\nalias dc=\"sudo docker-compose \"' | tee -a /home/${user}/.bashrc &gt; /dev/null\n  echo -e 'alias ctop=\"sudo ctop\"\\n' | tee -a /home/${user}/.bashrc &gt; /dev/null\n\n  # check if exist\n  [ ! -h \"/home/{user}/admin\" ] &amp;&amp; ln -s ${ADM_HOME} /home/${user}/admin\ndone\n\necho \"&gt;&gt;&gt; Creating Docker Stacks\"\n# create helper networks\nfor name in ${!HELPER[@]}; do\n  docker network inspect ${name} &gt;/dev/null 2&gt;&amp;1 || docker network create --subnet ${HELPER[${name}]} ${name}\ndone\n\n# create stack logic\nmkdir -p ${ADM_HOME}/{services,images,tools,docs}/\nfor name in ${!STACKS[@]}; do\n  mkdir -p \"${ADM_HOME}/{services,images}/${name}/\" \"/srv/${name}/\"\n\n  # create stack network\n  docker network inspect ${name} &gt;/dev/null 2&gt;&amp;1 || docker network create --subnet ${STACKS[${name}]} ${name}\n\n  # create docker-compose.yml\n  [ ! -f \"${ADM_HOME}/services/${name}/docker-compose.yml\" ] &amp;&amp; create_compose \"${ADM_HOME}/services/${name}/docker-compose.yml\"\ndone\n\n# adjust permissions\nchown -R root:admin ${ADM_HOME}\nfind ${ADM_HOME} -type d -exec chmod 0775 {} \\;\nfind ${ADM_HOME} -type f -exec chmod 0664 {} \\;\nfind ${ADM_HOME}/tools/ -type f -exec chmod 0775 {} \\;\n</code></pre> Struktur meines Ansible Repositories <pre><code>ansible\n\u251c\u2500\u2500 group_vars\n\u251c\u2500\u2500 host_vars\n\u2502   \u251c\u2500\u2500 example.felbinger.eu\n\u2502   \u251c\u2500\u2500 monitoring.felbinger.eu\n\u2502   \u251c\u2500\u2500 netbox.felbinger.eu\n\u2502   \u251c\u2500\u2500 preseed.felbinger.eu\n\u2502   \u2514\u2500\u2500 vyos.felbinger.eu\n\u251c\u2500\u2500 roles\n\u2502   \u251c\u2500\u2500 ansible-role-felbinger_container\n\u2502   \u2502   \u251c\u2500\u2500 defaults\n\u2502   \u2502   \u2514\u2500\u2500 tasks\n\u2502   \u251c\u2500\u2500 ansible-role-felbinger_logging\n\u2502   \u2502   \u251c\u2500\u2500 handlers\n\u2502   \u2502   \u2514\u2500\u2500 tasks\n\u2502   \u251c\u2500\u2500 ansible-role-felbinger_monitoring\n\u2502   \u2502   \u251c\u2500\u2500 defaults\n\u2502   \u2502   \u251c\u2500\u2500 files\n\u2502   \u2502   \u251c\u2500\u2500 tasks\n\u2502   \u2502   \u2514\u2500\u2500 templates\n\u2502   \u251c\u2500\u2500 ansible-role-felbinger_netbox_init\n\u2502   \u2502   \u2514\u2500\u2500 tasks\n\u2502   \u2514\u2500\u2500 ansible-role-felbinger_nginx\n\u2502       \u251c\u2500\u2500 handlers\n\u2502       \u251c\u2500\u2500 tasks\n\u2502       \u2514\u2500\u2500 templates\n\u251c\u2500\u2500 tasks\n\u2514\u2500\u2500 templates\n</code></pre> Debian Preseed Konfiguration <pre><code>#_preseed_V1\n#### Contents of the preconfiguration file (for bullseye)\n### Localization\n# Preseeding only locale sets language, country and locale.\nd-i debian-installer/locale string en_US\n\n# The values can also be preseeded individually for greater flexibility.\n#d-i debian-installer/language string en\n#d-i debian-installer/country string US\n#d-i debian-installer/locale string en_US.UTF-8\n# Optionally specify additional locales to be generated.\n#d-i localechooser/supported-locales multiselect en_US.UTF-8, nl_NL.UTF-8\n\n# Keyboard selection.\nd-i keyboard-configuration/xkb-keymap select de\n# d-i keyboard-configuration/toggle select No toggling\n\n### Network configuration\n# Disable network configuration entirely. This is useful for cdrom\n# installations on non-networked devices where the network questions,\n# warning and long timeouts are a nuisance.\n#d-i netcfg/enable boolean false\n\n# netcfg will choose an interface that has link if possible. This makes it\n# skip displaying a list if there is more than one interface.\nd-i netcfg/choose_interface select auto\n\n# To pick a particular interface instead:\n#d-i netcfg/choose_interface select eth1\n\n# To set a different link detection timeout (default is 3 seconds).\n# Values are interpreted as seconds.\n#d-i netcfg/link_wait_timeout string 10\n\n# If you have a slow dhcp server and the installer times out waiting for\n# it, this might be useful.\n#d-i netcfg/dhcp_timeout string 60\n#d-i netcfg/dhcpv6_timeout string 60\n\n# If you prefer to configure the network manually, uncomment this line and\n# the static network configuration below.\n#d-i netcfg/disable_autoconfig boolean true\n\n# If you want the preconfiguration file to work on systems both with and\n# without a dhcp server, uncomment these lines and the static network\n# configuration below.\n#d-i netcfg/dhcp_failed note\n#d-i netcfg/dhcp_options select Configure network manually\n\n# Static network configuration.\n#\n# IPv4 example\n#d-i netcfg/get_ipaddress string 192.168.1.42\n#d-i netcfg/get_netmask string 255.255.255.0\n#d-i netcfg/get_gateway string 192.168.1.1\n#d-i netcfg/get_nameservers string 192.168.1.1\n#d-i netcfg/confirm_static boolean true\n#\n# IPv6 example\n#d-i netcfg/get_ipaddress string fc00::2\n#d-i netcfg/get_netmask string ffff:ffff:ffff:ffff::\n#d-i netcfg/get_gateway string fc00::1\n#d-i netcfg/get_nameservers string fc00::1\n#d-i netcfg/confirm_static boolean true\n\n# Any hostname and domain names assigned from dhcp take precedence over\n# values set here. However, setting the values still prevents the questions\n# from being shown, even if values come from dhcp.\n#d-i netcfg/get_hostname string unassigned-hostname\n#d-i netcfg/get_domain string unassigned-domain\n\n# If you want to force a hostname, regardless of what either the DHCP\n# server returns or what the reverse DNS entry for the IP is, uncomment\n# and adjust the following line.\n#d-i netcfg/hostname string somehost\n\n# Disable that annoying WEP key dialog.\nd-i netcfg/wireless_wep string\n# The wacky dhcp hostname that some ISPs use as a password of sorts.\n#d-i netcfg/dhcp_hostname string radish\n\n# If non-free firmware is needed for the network or other hardware, you can\n# configure the installer to always try to load it, without prompting. Or\n# change to false to disable asking.\n#d-i hw-detect/load_firmware boolean true\n\n### Network console\n# Use the following settings if you wish to make use of the network-console\n# component for remote installation over SSH. This only makes sense if you\n# intend to perform the remainder of the installation manually.\n#d-i anna/choose_modules string network-console\n#d-i network-console/authorized_keys_url string http://10.0.0.1/openssh-key\n#d-i network-console/password password r00tme\n#d-i network-console/password-again password r00tme\n\n### Mirror settings\n# If you select ftp, the mirror/country string does not need to be set.\n#d-i mirror/protocol string ftp\n#d-i mirror/country string manual\n#d-i mirror/http/hostname string http.us.debian.org\n#d-i mirror/http/directory string /debian\n#d-i mirror/http/proxy string\n\n# Suite to install.\n#d-i mirror/suite string testing\n# Suite to use for loading installer components (optional).\n#d-i mirror/udeb/suite string testing\n\n### Account setup\n# Skip creation of a root account (normal user account will be able to\n# use sudo).\nd-i passwd/root-login boolean false\n# Alternatively, to skip creation of a normal user account.\n#d-i passwd/make-user boolean false\n\n# Root password, either in clear text\n#d-i passwd/root-password password r00tme\n#d-i passwd/root-password-again password r00tme\n# or encrypted using a crypt(3)  hash.\n#d-i passwd/root-password-crypted password $6$iX9o7PncqLMMb/ds$R1lMbxbOrctLbfe.eFk2nvduBbvL8Zzb/t/PPfUtzgb74n3Cehe9CZ42G5xx9U09DN27Z.CxwByJG60ylKfv50\n\n# To create a normal user account.\nd-i passwd/user-fullname string Ansible\nd-i passwd/username string ansible\n# Normal user's password, either in clear text\n#d-i passwd/user-password password insecure\n#d-i passwd/user-password-again password insecure\n# or encrypted using a crypt(3) hash.\nd-i passwd/user-password-crypted password $6$iX9o7PncqLMMb/ds$R1lMbxbOrctLbfe.eFk2nvduBbvL8Zzb/t/PPfUtzgb74n3Cehe9CZ42G5xx9U09DN27Z.CxwByJG60ylKfv50\n# Create the first user with the specified UID instead of the default.\n#d-i passwd/user-uid string 1010\n\n# The user account will be added to some standard initial groups. To\n# override that, use this.\n#d-i passwd/user-default-groups string sudo\n\n### Clock and time zone setup\n# Controls whether or not the hardware clock is set to UTC.\nd-i clock-setup/utc boolean true\n\n# You may set this to any valid setting for $TZ; see the contents of\n# /usr/share/zoneinfo/ for valid values.\nd-i time/zone string Europe/Berlin\n\n# Controls whether to use NTP to set the clock during the install\nd-i clock-setup/ntp boolean true\n# NTP server to use. The default is almost always fine here.\n#d-i clock-setup/ntp-server string ntp.example.com\n\n### Partitioning\n## Partitioning example\n# If the system has free space you can choose to only partition that space.\n# This is only honoured if partman-auto/method (below) is not set.\n#d-i partman-auto/init_automatically_partition select biggest_free\n\n# Alternatively, you may specify a disk to partition. If the system has only\n# one disk the installer will default to using that, but otherwise the device\n# name must be given in traditional, non-devfs format (so e.g. /dev/sda\n# and not e.g. /dev/discs/disc0/disc).\n# For example, to use the first SCSI/SATA hard disk:\n#d-i partman-auto/disk string /dev/sda\n# In addition, you'll need to specify the method to use.\n# The presently available methods are:\n# - regular: use the usual partition types for your architecture\n# - lvm:     use LVM to partition the disk\n# - crypto:  use LVM within an encrypted partition\nd-i partman-auto/method string lvm\n\nd-i partman-auto-lvm/new_vg_name string debian-vg\n\n# You can define the amount of space that will be used for the LVM volume\n# group. It can either be a size with its unit (eg. 20 GB), a percentage of\n# free space or the 'max' keyword.\nd-i partman-auto-lvm/guided_size string max\n\n# If one of the disks that are going to be automatically partitioned\n# contains an old LVM configuration, the user will normally receive a\n# warning. This can be preseeded away...\nd-i partman-lvm/device_remove_lvm boolean true\n# The same applies to pre-existing software RAID array:\nd-i partman-md/device_remove_md boolean true\n# And the same goes for the confirmation to write the lvm partitions.\nd-i partman-lvm/confirm boolean true\nd-i partman-lvm/confirm_nooverwrite boolean true\n\n# You can choose one of the three predefined partitioning recipes:\n# - atomic: all files in one partition\n# - home:   separate /home partition\n# - multi:  separate /home, /var, and /tmp partitions\nd-i partman-auto/choose_recipe select atomic\n\n# Or provide a recipe of your own...\n# If you have a way to get a recipe file into the d-i environment, you can\n# just point at it.\n#d-i partman-auto/expert_recipe_file string /hd-media/recipe\n\n# If not, you can put an entire recipe into the preconfiguration file in one\n# (logical) line. This example creates a small /boot partition, suitable\n# swap, and uses the rest of the space for the root partition:\n#d-i partman-auto/expert_recipe string                         \\\n#      boot-root ::                                            \\\n#              40 50 100 ext3                                  \\\n#                      $primary{ } $bootable{ }                \\\n#                      method{ format } format{ }              \\\n#                      use_filesystem{ } filesystem{ ext3 }    \\\n#                      mountpoint{ /boot }                     \\\n#              .                                               \\\n#              500 10000 1000000000 ext3                       \\\n#                      method{ format } format{ }              \\\n#                      use_filesystem{ } filesystem{ ext3 }    \\\n#                      mountpoint{ / }                         \\\n#              .                                               \\\n#              64 512 300% linux-swap                          \\\n#                      method{ swap } format{ }                \\\n#              .\n\n# The full recipe format is documented in the file partman-auto-recipe.txt\n# included in the 'debian-installer' package or available from D-I source\n# repository. This also documents how to specify settings such as file\n# system labels, volume group names and which physical devices to include\n# in a volume group.\n\n## Partitioning for EFI\n# If your system needs an EFI partition you could add something like\n# this to the recipe above, as the first element in the recipe:\n#               538 538 1075 free                              \\\n#                      $iflabel{ gpt }                         \\\n#                      $reusemethod{ }                         \\\n#                      method{ efi }                           \\\n#                      format{ }                               \\\n#               .                                              \\\n#\n# The fragment above is for the amd64 architecture; the details may be\n# different on other architectures. The 'partman-auto' package in the\n# D-I source repository may have an example you can follow.\n\n# This makes partman automatically partition without confirmation, provided\n# that you told it what to do using one of the methods above.\nd-i partman-partitioning/confirm_write_new_label boolean true\nd-i partman/choose_partition select finish\nd-i partman/confirm boolean true\nd-i partman/confirm_nooverwrite boolean true\n\n# Force UEFI booting ('BIOS compatibility' will be lost). Default: false.\n#d-i partman-efi/non_efi_system boolean true\n# Ensure the partition table is GPT - this is required for EFI\n#d-i partman-partitioning/choose_label string gpt\n#d-i partman-partitioning/default_label string gpt\n\n# When disk encryption is enabled, skip wiping the partitions beforehand.\n#d-i partman-auto-crypto/erase_disks boolean false\n\n## Partitioning using RAID\n# The method should be set to \"raid\".\n#d-i partman-auto/method string raid\n# Specify the disks to be partitioned. They will all get the same layout,\n# so this will only work if the disks are the same size.\n#d-i partman-auto/disk string /dev/sda /dev/sdb\n\n# Next you need to specify the physical partitions that will be used.\n#d-i partman-auto/expert_recipe string \\\n#      multiraid ::                                         \\\n#              1000 5000 4000 raid                          \\\n#                      $primary{ } method{ raid }           \\\n#              .                                            \\\n#              64 512 300% raid                             \\\n#                      method{ raid }                       \\\n#              .                                            \\\n#              500 10000 1000000000 raid                    \\\n#                      method{ raid }                       \\\n#              .\n\n# Last you need to specify how the previously defined partitions will be\n# used in the RAID setup. Remember to use the correct partition numbers\n# for logical partitions. RAID levels 0, 1, 5, 6 and 10 are supported;\n# devices are separated using \"#\".\n# Parameters are:\n# &lt;raidtype&gt; &lt;devcount&gt; &lt;sparecount&gt; &lt;fstype&gt; &lt;mountpoint&gt; \\\n#          &lt;devices&gt; &lt;sparedevices&gt;\n\n#d-i partman-auto-raid/recipe string \\\n#    1 2 0 ext3 /                    \\\n#          /dev/sda1#/dev/sdb1       \\\n#    .                               \\\n#    1 2 0 swap -                    \\\n#          /dev/sda5#/dev/sdb5       \\\n#    .                               \\\n#    0 2 0 ext3 /home                \\\n#          /dev/sda6#/dev/sdb6       \\\n#    .\n\n# For additional information see the file partman-auto-raid-recipe.txt\n# included in the 'debian-installer' package or available from D-I source\n# repository.\n\n# This makes partman automatically partition without confirmation.\nd-i partman-md/confirm boolean true\nd-i partman-partitioning/confirm_write_new_label boolean true\nd-i partman/choose_partition select finish\nd-i partman/confirm boolean true\nd-i partman/confirm_nooverwrite boolean true\n\n## Controlling how partitions are mounted\n# The default is to mount by UUID, but you can also choose \"traditional\" to\n# use traditional device names, or \"label\" to try filesystem labels before\n# falling back to UUIDs.\n#d-i partman/mount_style select uuid\n\n### Base system installation\n# Configure APT to not install recommended packages by default. Use of this\n# option can result in an incomplete system and should only be used by very\n# experienced users.\n#d-i base-installer/install-recommends boolean false\n\n# The kernel image (meta) package to be installed; \"none\" can be used if no\n# kernel is to be installed.\n#d-i base-installer/kernel/image string linux-image-686\n\n### Apt setup\n# You can choose to install non-free and contrib software.\n#d-i apt-setup/non-free boolean true\n#d-i apt-setup/contrib boolean true\n# Uncomment this if you don't want to use a network mirror.\n#d-i apt-setup/use_mirror boolean false\n# Select which update services to use; define the mirrors to be used.\n# Values shown below are the normal defaults.\n#d-i apt-setup/services-select multiselect security, updates\n#d-i apt-setup/security_host string security.debian.org\n\n# Additional repositories, local[0-9] available\n#d-i apt-setup/local0/repository string \\\n#       http://local.server/debian stable main\n# https://docs.hetzner.com/robot/dedicated-server/operating-systems/hetzner-aptitude-mirror/\nd-i apt-setup/local0/repository string http://deb.debian.org/debian/ bullseye main contrib non-free\nd-i apt-setup/local1/repository string http://deb.debian.org/debian/ bullseye-updates main contrib non-free\n#d-i apt-setup/local2/repository string http://security.debian.org/debian-security bullseye-security main contrib non-free  # exists by default\n#d-i apt-setup/local0/comment string local server\n# Enable deb-src lines\nd-i apt-setup/local0/source boolean true\nd-i apt-setup/local1/source boolean true\n# URL to the public key of the local repository; you must provide a key or\n# apt will complain about the unauthenticated repository and so the\n# sources.list line will be left commented out.\n#d-i apt-setup/local0/key string http://local.server/key\n# If the provided key file ends in \".asc\" the key file needs to be an\n# ASCII-armoured PGP key, if it ends in \".gpg\" it needs to use the\n# \"GPG key public keyring\" format, the \"keybox database\" format is\n# currently not supported.\n\n# By default the installer requires that repositories be authenticated\n# using a known gpg key. This setting can be used to disable that\n# authentication. Warning: Insecure, not recommended.\n#d-i debian-installer/allow_unauthenticated boolean true\n\n# Uncomment this to add multiarch configuration for i386\n#d-i apt-setup/multiarch string i386\n\n\n### Package selection\ntasksel tasksel/first multiselect standard\n\n# Individual additional packages to install\n#d-i pkgsel/include string openssh-server build-essential\nd-i pkgsel/include string wget curl sudo sed python3 openssh-server build-essential\n# Whether to upgrade packages after debootstrap.\n# Allowed values: none, safe-upgrade, full-upgrade\n#d-i pkgsel/upgrade select none\n\n# Some versions of the installer can report back on what software you have\n# installed, and what software you use. The default is not to report back,\n# but sending reports helps the project determine what software is most\n# popular and should be included on the first CD/DVD.\n#popularity-contest popularity-contest/participate boolean false\n\n### Boot loader installation\n# Grub is the boot loader (for x86).\n\n# This is fairly safe to set, it makes grub install automatically to the UEFI\n# partition/boot record if no other operating system is detected on the machine.\nd-i grub-installer/only_debian boolean true\n\n# This one makes grub-installer install to the UEFI partition/boot record, if\n# it also finds some other OS, which is less safe as it might not be able to\n# boot that other OS.\n#d-i grub-installer/with_other_os boolean true\n\n# Due notably to potential USB sticks, the location of the primary drive can\n# not be determined safely in general, so this needs to be specified:\n#d-i grub-installer/bootdev  string /dev/sda\n# To install to the primary device (assuming it is not a USB stick):\nd-i grub-installer/bootdev  string default\n\n# Alternatively, if you want to install to a location other than the UEFI\n# parition/boot record, uncomment and edit these lines:\n#d-i grub-installer/only_debian boolean false\n#d-i grub-installer/with_other_os boolean false\n#d-i grub-installer/bootdev  string (hd0,1)\n# To install grub to multiple disks:\n#d-i grub-installer/bootdev  string (hd0,1) (hd1,1) (hd2,1)\n\n# Optional password for grub, either in clear text\n#d-i grub-installer/password password r00tme\n#d-i grub-installer/password-again password r00tme\n# or encrypted using an MD5 hash, see grub-md5-crypt(8).\n#d-i grub-installer/password-crypted password [MD5 hash]\n\n# Use the following option to add additional boot parameters for the\n# installed system (if supported by the bootloader installer).\n# Note: options passed to the installer will be added automatically.\n#d-i debian-installer/add-kernel-opts string nousb\n\n### Finishing up the installation\n# During installations from serial console, the regular virtual consoles\n# (VT1-VT6) are normally disabled in /etc/inittab. Uncomment the next\n# line to prevent this.\n#d-i finish-install/keep-consoles boolean true\n\n# Avoid that last message about the install being complete.\nd-i finish-install/reboot_in_progress note\n\n# This will prevent the installer from ejecting the CD during the reboot,\n# which is useful in some situations.\n#d-i cdrom-detect/eject boolean false\n\n# This is how to make the installer shutdown when finished, but not\n# reboot into the installed system.\n#d-i debian-installer/exit/halt boolean true\n# This will power off the machine instead of just halting it.\n#d-i debian-installer/exit/poweroff boolean true\n\n### Preseeding other packages\n# Depending on what software you choose to install, or if things go wrong\n# during the installation process, it's possible that other questions may\n# be asked. You can preseed those too, of course. To get a list of every\n# possible question that could be asked during an install, do an\n# installation, and then run these commands:\n#   debconf-get-selections --installer &gt; file\n#   debconf-get-selections &gt;&gt; file\n\n\n#### Advanced options\n### Running custom commands during the installation\n# d-i preseeding is inherently not secure. Nothing in the installer checks\n# for attempts at buffer overflows or other exploits of the values of a\n# preconfiguration file like this one. Only use preconfiguration files from\n# trusted locations! To drive that home, and because it's generally useful,\n# here's a way to run any shell command you'd like inside the installer,\n# automatically.\n\n# This first command is run as early as possible, just after\n# preseeding is read.\n#d-i preseed/early_command string anna-install some-udeb\n# This command is run immediately before the partitioner starts. It may be\n# useful to apply dynamic partitioner preseeding that depends on the state\n# of the disks (which may not be visible when preseed/early_command runs).\n#d-i partman/early_command \\\n#       string debconf-set partman-auto/disk \"$(list-devices disk | head -n1)\"\n# This command is run just before the install finishes, but when there is\n# still a usable /target directory. You can chroot to /target and use it\n# directly, or use the apt-install and in-target commands to easily install\n# packages and run commands in the target system.\n#d-i preseed/late_command string apt-install zsh; in-target chsh -s /bin/zsh\n\nd-i preseed/late_command string in-target sed -i \"/^deb cdrom:/s/^/# /\" /etc/apt/sources.list; \\\n                                in-target sed -i -e \"/#PermitRootLogin.* /{ s|#|| ; s|prohibit-password|no| }\" /etc/ssh/sshd_config; \\\n                                in-target sed -i -e \"/#PasswordAuthentication.* /{ s|#|| ; s|yes|no| }\" /etc/ssh/sshd_config; \\\n                                in-target mkdir -p /home/ansible/.ssh/; \\\n                                in-target chown -R ansible:ansible /home/ansible/.ssh; \\\n                                in-target sh -c 'echo \"ssh-rsa &lt;-cut-&gt; ansible@WS1\" &gt;&gt; /home/ansible/.ssh/authorized_keys';\n</code></pre> <p>Der Wunsch nach einer besseren L\u00f6sung f\u00fchrte mich schlie\u00dflich zu NixOS. Bereits 2020 erz\u00e4hlte mir ein Bekannter von den Vorteilen. Zun\u00e4chst war ich skeptisch, doch als immer mehr Freunde und Kollegen von ihren positiven Erfahrungen berichteten, begann ich mich n\u00e4her mit dem Konzept auseinanderzusetzen.</p> <p>Der Nix-Paketmanager klang vielversprechend, aber auch ungewohnt. Mein erstes Experiment war eine Testinstallation in einer VM - und schon nach kurzer Zeit erkannte ich das Potenzial. Die anf\u00e4ngliche Lernkurve war zwar steil, aber ich merkte schnell, dass sich der Aufwand lohnte.</p> <p>Nachdem die ersten Tests vielversprechend verliefen, installierte ich NixOS auf meinem Notebook. Anschlie\u00dfend begann ich, einzelne Dienste wie einen Monitoring-Server und einen NetBox-Server mit NixOS umzusetzen. Da dies reibungslos funktionierte, entschied ich mich, nach und nach immer mehr Systeme umzustellen.</p> <p>Im Rahmen einer wissenschaftlichen Arbeit analysierte ich zudem die Sicherheit von NixOS. In diesem Rahmen kann ich besonders die Doktorarbeit von E. Dolstra zu Nix, sowie das Paper zur Finalisierung von NixOS empfehlen. Diese Arbeiten geben tiefe Einblicke in die Architektur von Nix und NixOS.</p> <p>Der Umstieg auf NixOS war f\u00fcr mich ein logischer Schritt, um mein System zuverl\u00e4ssiger, flexibler und effizienter zu verwalten. Obwohl die Lernkurve anfangs sehr steil war, hat sich der Aufwand mehr als gelohnt. Heute genie\u00dfe ich die Vorteile eines vollst\u00e4ndig deklarativen und reproduzierbaren Systems - und kann mir kaum vorstellen, zu einer klassischen Linux-Distribution zur\u00fcckzukehren.</p>"},{"location":"knowledgebase/android.html","title":"Android","text":""},{"location":"knowledgebase/android.html#samsung-galaxy-a3","title":"Samsung Galaxy A3","text":"<ul> <li>LineageOS: Samsung Galaxy A3 (2017) - SM-A320FL - a3y17lte</li> </ul>"},{"location":"knowledgebase/android.html#asus-nexus-7","title":"Asus Nexus 7","text":"<ul> <li>Original firmware: developers.google.com/android/ota</li> <li>LinageOS: wiki.lineageos.org/devices/flox/install.</li> <li>Nethunter: pentestit.de/kali-nethunter-2020-teil-1-installation-auf-nexus-7/</li> <li>Flash TWRP   <pre><code># adb devices\nList of devices attached\n0909da6e  recovery\n\n# adb reboot bootloader\n\n# sudo fastboot devices\n0909da6e  fastboot\n\n# sudo fastboot oem unlock\n(bootloader) Unlocking bootloader...\n(bootloader) erasing userdata...\n(bootloader) erasing userdata done\n(bootloader) erasing cache...\n(bootloader) erasing cache done\n(bootloader) Unlocking bootloader done!\nOKAY [ 24.086s]\nFinished. Total time: 24.086s\n\n# sudo fastboot flash recovery twrp-3.5.2_9-0-flo.img\nSending 'recovery' (10060 KB)                      OKAY [  0.325s]\nWriting 'recovery'                                 OKAY [  0.386s]\nFinished. Total time: 0.723s\n\n# sudo fastboot reboot recovery\n</code></pre></li> </ul>"},{"location":"knowledgebase/android.html#google-pixel-4a","title":"Google Pixel 4a","text":"<ul> <li>Original firmware: developers.google.com/android/ota</li> <li>LineageOS: wiki.lineageos.org/devices/sunfish/</li> <li>GrapheneOS: grapheneos.org/releases</li> </ul>"},{"location":"knowledgebase/applications.html","title":"Applications","text":""},{"location":"knowledgebase/applications.html#browser-addons","title":"Browser Addons","text":"<ul> <li> <p>UBlock</p> </li> <li> <p>HTTPs Everywhere (Google Chrome)</p> </li> <li> <p>FoxyProxy (Google Chrome, Mozilla Firefox)</p> </li> <li> <p>User Agent Switcher (Google Chrome, Mozilla Firefox)</p> </li> <li> <p>Skip Redirect (Google Chrome, Mozilla Firefox)</p> </li> <li> <p>Tamper Data (Google Chrome, Mozilla Firefox)</p> </li> <li> <p>Wappalyzer (Google Chrome, Mozilla Firefox)</p> </li> <li> <p>JSON View (Google Chrome)</p> </li> <li> <p>HackTools (Mozilla Firefox)</p> </li> </ul>"},{"location":"knowledgebase/applications.html#android-apps","title":"Android Apps","text":"<ul> <li> <p>ScreenStream lets you stream the screen of your phone / tablet over http. (Google Play, F-Droid)</p> </li> <li> <p>KeePassDX is an open source password manager for android that supports databases in the kdbx format. (Google Play, F-Droid)</p> </li> <li> <p>NFC Tools (closed source)</p> </li> <li> <p>nRF Connect (closed source) for bluetooth stuff</p> </li> </ul>"},{"location":"knowledgebase/applications.html#it-security","title":"IT-Security","text":""},{"location":"knowledgebase/applications.html#reverse-engineering","title":"Reverse Engineering","text":"<ul> <li>Free IDA (hexrays)</li> <li>Ghidra</li> <li>radare2 + Cutter</li> <li>gdb</li> <li>ILSpy (Windows) / JetBrains dotPeek (Windows)</li> <li>Peid (Windows)</li> <li>x64dbg (Windows)</li> <li>Regshot</li> <li>HxD (Hex Editor, Windows)</li> </ul>"},{"location":"knowledgebase/applications.html#privilege-escalation","title":"Privilege Escalation","text":"<ul> <li>Reverse Shells</li> <li>GTFObins</li> <li>WADComs</li> <li>LOLBAS</li> <li>Static Binaries</li> <li>LinEnum.sh</li> <li>linpeas.sh</li> <li>pspy - linux process monitor without permissions</li> <li>PayloadAllTheThings</li> <li>HackTricks</li> </ul>"},{"location":"knowledgebase/applications.html#ctf-tools","title":"CTF Tools","text":"<ul> <li>CyberChef</li> <li>Cryptool</li> <li>Aperi'Solve</li> </ul>"},{"location":"knowledgebase/ben-eater-8bit-computer.html","title":"Ben Eater: 8bit Computer","text":"<ul> <li>eater.net/8bit</li> </ul>"},{"location":"knowledgebase/ben-eater-8bit-computer.html#parts-in-germany","title":"Parts in Germany","text":"Qty. Description Link 14 Breadboard https://www.reichelt.com/experimentier-steckboard-640-200-kontakte-steckboard-1k2v-p67678.html 10 1k\u03a9 resistor https://www.reichelt.com/de/de/widerstand-kohleschicht-1-0-kohm-0207-250-mw-5--k-o-rd14jn102t52-p237397.html 9 10k\u03a9 resistor https://www.reichelt.com/widerstand-kohleschicht-10-kohm-0207-250-mw-5--1-4w-10k-p1338.html 1 100k\u03a9 resistor https://www.reichelt.com/widerstand-kohleschicht-100-kohm-0207-250-mw-5--1-4w-100k-p1337.html 24 470\u03a9 resistor https://www.reichelt.com/de/de/widerstand-kohleschicht-470-ohm-0207-250-mw-5--k-o-rd14jn471t52-p237375.html 1 1M\u03a9 resistor https://www.reichelt.com/widerstand-kohleschicht-1-0-mohm-0207-250-mw-5--1-4w-1-0m-p1316.html 1 1M\u03a9 potentiometer https://www.reichelt.com/einstellpotentiometer-liegend-1-0-mohm-9-mm-acp-9-l-1m-p110249.html 6 0.01\u00b5F capacitor (10 nF) https://www.reichelt.com/keramik-kondensator-10-nf-0-v-20-85-c-hita-ke3f103m-l0-p246906.html 16 0.1\u00b5F capacitor (100 nF) https://www.reichelt.com/vielschicht-kerko-100-nf-50-v-rm-5-125-c-hita-sf1h104z-l5-p246835.html 1 1\u00b5F capacitor (Elektrolytkondensator) https://www.reichelt.com/elko-radial-1-0-f-100v-rm2-5-1000h-105-c-20--rad-105-1-0-100-p42393.html 4 555 timer IC (NE555) https://www.reichelt.com/timer-ic-typ-555-dip-8-ne-555-dip-p13396.html 2 74LS00 (Quad NAND gate) https://www.reichelt.com/nand-gate-2-input-4-75--5-25-v-dil-14-sn-74ls00n-tex-p216916.html 1 74LS02 (Quad NOR gate) https://www.reichelt.com/nor-gate-2-input-4-75--5-25-v-dil-14-ls-02-p10586.html 5 74LS04 (Hex inverter) https://www.reichelt.com/inverter-hex-4-75--5-25-v-dil-14-ls-04-p10588.html 3 74LS08 (Quad AND gate) https://www.reichelt.com/and-gate-2-element-4-75--5-25-v-dil-14-ls-08-p10592.html 1 74LS32 (Quad OR gate) https://www.reichelt.com/or-gate-2-input-4-75--5-25-v-dil-14-ls-32-p10698.html 1 74LS107 (Dual JK flip-flop) Note: The videos use the 74LS76 which is extremely difficult to find. The 74LS107 is functionally equivalent but be careful: it has a different pinout. https://www.reichelt.com/flip-flop-jk-type-dual-4-75--5-25-v-dil-14-ls-107-p10595.html 2 74LS86 (Quad XOR gate) https://www.reichelt.com/xor-gate-quad-4-75--5-25-v-dil-14-sn-74ls86an-tex-p219266.html 1 74LS138 (3-to-8 line decoder) https://www.reichelt.com/3-line-to-8-line-decoder-demultiplexer-dil-16-ls-138-p10612.html 1 74LS139 (Dual 2-line to 4-line decoder) https://www.reichelt.com/decoder-mpx-2-to-4-4-75--5-25-v-dil-16-ls-139-p10613.html 4 74LS157 (Quad 2-to-1 line data selector / Multiplexer) https://www.reichelt.com/multiplexer-lp-schottky-4-75--5-25-v-dil-16-ls-157-p10625.html 6 74LS245 (Octal bus transceiver) https://www.reichelt.com/transceiver-octal-4-75--5-25-v-dip-20-ls-245-p10667.html 1 74LS273 (Octal D flip-flop) https://www.reichelt.com/flip-flop-d-type-lp-schottky-4-75--5-25-v-dil-20-ls-273-p10683.html 3 Momentary 6mm tact switch https://www.reichelt.com/de/de/kurzhubtaster-6x6mm-hoehe-4-3mm-12v-vertikal-taster-3301-p27892.html 1 8-position DIP switch https://www.reichelt.com/dip-schalter-liegend-8-polig-nt-08-p13534.html 1 4-position DIP switch https://www.reichelt.com/dip-schalter-liegend-4-polig-nt-04-p13532.html 44 Red LED https://www.reichelt.com/de/de/led-5-mm-bedrahtet-rot-fr-led-5-rd-dif-p230933.html 8 Yellow LED https://www.reichelt.com/de/de/led-5-mm-bedrahtet-gelb-fr-led-5-ye-dif-p230934.html 12 Green LED https://www.reichelt.com/de/de/led-5-mm-bedrahtet-gruen-20-mcd-30--kbt-l-7113gd-p230939.html 21 Blue LED (haven\u2019t ordered those, simply use another color\u2026) https://www.reichelt.com/led-5-mm-bedrahtet-blau-300-mcd-40--wue-151051bs0400-p231007.html 4 Common cathode 7-segment display https://www.reichelt.com/7-segment-anzeige-gelb-13-5mm-gem-kathode-sc-52-11-ge-p6939.html 3 28C16 EEPROM ebay, no longer existing. 2 74LS161 (4-bit synchronous binary counter) https://www.ebay.de/itm/74LS161AN-SN74LS161N-SYNCHRONOUS-4-BIT-COUNTER-74LS161-IC-2-pieces/132330121050 8 74LS173 (4-bit D-type register) https://www.ebay.de/itm/10pcs-SN74LS173AN-DIP16-74LS173-4-BIT-D-TYPE-REGISTERS-NEW/392279233856 2 74LS283 (4-bit binary full adder) ebay, no longer existing. 2 74LS189 (64-bit random access memory) https://www.ebay.de/itm/5pcs-Dip16-Integrated-Circuit-Logic-IC-SN74LS189AN/132879439788?hash=item1ef03b57ac:g:mD8AAOSwO-hcCQU4 1 22 AWG Solid Tinned-Copper Hook-Up Wire (diverse Farben) https://www.amazon.de/TUOFENG-Volldraht-Volldraht-Kit-6-verschiedenfarbige-9-Meter-Spulen-Gauge-%C3%9Cberbr%C3%BCckungsdraht-Auflegungsdraht-Kit/dp/B07V5FVSYL 3 Double-throw toggle switch ebay, no longer existing. <p>2x 74F189 (64-bit random access memory) still not ordered yet</p>"},{"location":"knowledgebase/ben-eater-8bit-computer.html#datasheets","title":"Datasheets","text":"<ul> <li>74F189_64bit-RAM</li> <li>74LS00_NAND</li> <li>74LS02_NOR</li> <li>74LS04_Inverter</li> <li>74LS08_AND</li> <li>74LS32_OR</li> <li>74LS86_XOR</li> <li>74LS107_J-K-Flip-Flop</li> <li>74LS138_Demultiplexer</li> <li>74LS139_Demultiplexer</li> <li>74LS157_Multiplexer</li> <li>74LS161_4bit-Binary-Counter</li> <li>74LS173_D-Register</li> <li>74LS273_D-Flip-Flop</li> <li>74LS283_4bit-Binary-Full-Adder</li> <li>75LS245_Bus-Transceiver</li> <li>AT28C16_EEPROM</li> <li>NE555</li> </ul>"},{"location":"knowledgebase/cryptsetup.html","title":"Cryptsetup","text":""},{"location":"knowledgebase/cryptsetup.html#decrypt-using-ssh","title":"Decrypt using ssh","text":"<p>If you want to encrypt your system using cryptsetup to make it more difficult for curious administrators or attackers who were able to take over a hypervisor to access your data (at least if the virtual machine was previously offline), it is a good idea to set up the dropbear ssh server. This allows you to enter a password for decryption via ssh, instead of using the Proxmox vnc console, where copy/paste cannot be used.</p> <pre><code>apt install dropbear-initramfs\necho \"ssh-ed25519 ...\" | tee -a /etc/dropbear-initramfs/authorized_keys\n\n# adjust dropbear config\nsed -i 's|#\\(DROPBEAR_OPTIONS\\).*|\\1=\"-I 60 -R -F -E -j -k -p 2222 -s -c /bin/cryptroot-unlock\"|' /etc/dropbear-initramfs/config\n\n# enable networking in initramfs\n# format: ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;:&lt;dns-server-0-ip&gt;:&lt;dns-server-1-ip&gt;:&lt;ntp0-ip&gt;\n# use dhcp\nIP=:::::ens18:dhcp\n# or static ip\nIP=10.0.0.2::10.0.0.1:255.255.255.0\n\nupdate-initramfs -u\n</code></pre>"},{"location":"knowledgebase/cryptsetup.html#nuke-password","title":"Nuke password","text":"<p>Additionally you may want to create a nuke password for cryptsetup. If an attacker tries to log in with this password, all key information is deleted from the luks-header, so that it is impossible to decrypt it again.</p> <pre><code>apt install cryptsetup-nuke-password\necho NukePassword | /usr/lib/cryptsetup-nuke-password/crypt --generate\nupdate-initramfs -u\n</code></pre> <p>Afterwards, the system can continue to be used as normal. If the nuke password is entered, the key information in the luks-header is irrevocably deleted.</p> <p>For this reason, you should create a backup of the luks-headers. This can be restored via a live boot system in the event of a deletion. Keep in mind that you have to create the backup of the luks-header every time you change one of the decryption passphrases. <pre><code># backup header after initial setup and store it in a safe place.\ncryptsetup luksHeaderBackup /dev/sda5 --header-backup-file /root/luksheader.bck\n\n# restore luks header using live system\ncryptsetup luksHeaderRestore /dev/sda5 --header-backup-file &lt;file&gt;\n</code></pre></p>"},{"location":"knowledgebase/django.html","title":"Django","text":""},{"location":"knowledgebase/django.html#basic-structure","title":"Basic Structure","text":"<ol> <li>Initialize django project<ul> <li>Create project directory</li> <li>Create <code>README.md</code>, <code>LICENSE</code> and <code>.gitignore</code> using gitignore.io</li> <li>Add <code>Django==5.0.7</code> to <code>requirements.txt</code></li> <li>Initialize Django Project using <code>django-admin startproject app</code></li> </ul> </li> <li>Adjust django settings (<code>project-name/app/settings.py</code>)<ul> <li>Randomize <code>SECRET_KEY</code> <pre><code>import random\nfrom os import environ\nfrom string import punctuation, digits, ascii_letters\n\nSECRET_KEY = environ.get('SECRET_KEY', repr(''.join([\n  random.SystemRandom().choice(ascii_letters + digits + punctuation) for i in range(\n    random.randint(64, 80)\n  )])\n))\n</code></pre></li> <li>Make <code>DEBUG</code> and <code>ALLOWED_HOSTS</code> dynamic   <pre><code>DEBUG = bool(int(environ.get('DEBUG', '0')))\nALLOWED_HOSTS = environ.get('ALLOWED_HOSTS', '127.0.0.1').split(' ')\n</code></pre></li> <li>Adjust database configuration (PostgreSQL / MariaDB)</li> <li>Adjust paths to templates and static files   <pre><code>#TEMPLATES = [{\n#    'DIRS': [BASE_DIR.joinpath('templates'),],             # &lt;--- This line\n\nSTATIC_ROOT = BASE_DIR.joinpath('static')\n</code></pre></li> <li>Add django translations and set timezone   <pre><code>from django.utils.translation import gettext_lazy as _\n\nMIDDLEWARE = [\n  'django.middleware.security.SecurityMiddleware',\n  'django.contrib.sessions.middleware.SessionMiddleware',\n  'django.middleware.locale.LocaleMiddleware',              # &lt;--- this line\n  'django.middleware.common.CommonMiddleware',\n\nLANGUAGES = [\n    ('en', _('English')),\n    ('de', _('German')),\n]\n\nTIME_ZONE = 'Europe/Berlin'\n\nUSE_L10N = True\nUSE_I18N = True\n</code></pre>   Replace static list in <code>app/urls.py</code> with <code>i18n_patterns()</code> <pre><code>from django.conf.urls.i18n import i18n_patterns\nurlpatterns = i18n_patterns(\n    path('admin/', admin.site.urls),\n)\n</code></pre></li> <li>Rename admin Site   <pre><code># app/urls.py\n\nfrom django.utils.translation import gettext as _\n\nadmin.site.site_header = admin.site.site_title = _('Your project')\nadmin.site.index_title = _('Welcome to your project')\n</code></pre></li> </ul> </li> <li>Create django base app<ul> <li>Create app using <code>python3 manage.py startapp base</code></li> <li>Load base app in <code>app/settings.py</code>:   <pre><code>INSTALLED_APPS += [\n  'base.apps.BaseConfig',\n]\n</code></pre></li> <li>Add view, url routing and static files for <code>manifest.json</code> <pre><code># base/views.py\nfrom django.http import HttpRequest, JsonResponse\n\ndef manifest(request: HttpRequest) -&gt; JsonResponse:\n    return JsonResponse({\n        'name': '',\n        'short_name': '',\n        'icons': [\n            {\n                'src': 'img/android-chrome-192x192.png',\n                'sizes': '192x192',\n                'type': 'image/png'\n            }, {\n                'src': 'img/android-chrome-512x512.png',\n                'sizes': '512x512',\n                'type': 'image/png'\n            }\n        ],\n        'theme_color': '#ffffff',\n        'background_color': '#ffffff',\n        'display': 'standalone'\n    })\n</code></pre></li> </ul> </li> <li>[Optional] Add Django Rest Framework<ul> <li>Add <code>'rest_framework.apps.RestFrameworkConfig',</code> to <code>INSTALLED_APPS</code> in <code>app/settings.py</code></li> <li>Add <code>djangorestframework==3.15.2</code> to <code>requirements.txt</code></li> </ul> </li> <li>[Optional] Add open id connect to login (I suggest using keycloak or authentik instead of implementing authentification with support for multifactorauthentication yourself)</li> <li>[Optional] Add <code>Dockerfile</code> and <code>entrypoint.sh</code> to build docker image</li> <li>[Optional] Add continous integration pipeline to build and push docker image</li> </ol>"},{"location":"knowledgebase/django.html#extend-user-model","title":"Extend User Model","text":"<pre><code># base/models.py\nfrom django.contrib.auth.models import AbstractUser\nfrom django.db import models\n\n\nclass User(AbstractUser):\n    birthdate = models.DateField(null=True, blank=True)\n</code></pre> <pre><code># base/admin.py\nfrom base.models import User\nfrom django.contrib import admin\n\nadmin.site.register(User)\n</code></pre> <pre><code># app/settings.py\nAUTH_USER_MODEL = \"base.User\"\n</code></pre>"},{"location":"knowledgebase/ffmpeg.html","title":"ffmpeg","text":""},{"location":"knowledgebase/ffmpeg.html#static-color","title":"static color","text":"<pre><code>ffmpeg -f lavfi -i color=c=red:s=1280x720:d=10 -c:v libx264 -pix_fmt yuv420p output.mp4\n</code></pre>"},{"location":"knowledgebase/ffmpeg.html#stack-videos","title":"stack videos","text":"<pre><code># create videos with static color to visualize stacking\nfor c in red green blue yellow; do\n  ffmpeg -f lavfi -i color=c=${c}:s=1280x720:d=10 -c:v libx264 -pix_fmt yuv420p ${c}.mp4\ndone\n\nffmpeg \\\n  -i red.mp4 -i green.mp4 -i blue.mp4 -i yellow.mp4 \\\n  -filter_complex \" \\\n    [0:v][1:v][2:v][3:v]xstack=inputs=4:layout=0_0|w0_0|0_h0|w0_h0[out] \\\n  \" \\\n  -map \"[out]\" -c:v libx264 -crf 23 -preset veryfast output.mp4\n</code></pre>"},{"location":"knowledgebase/hosting.html","title":"Hosting","text":""},{"location":"knowledgebase/hosting.html#free-web-hosting","title":"Free Web Hosting","text":"<ul> <li>bplaced</li> <li>InfinityFree</li> <li>ProFreeHost</li> <li>AwardSpace</li> <li>Netlify</li> </ul>"},{"location":"knowledgebase/hosting.html#free-domains","title":"Free Domains","text":"<ul> <li>TK</li> <li>FreeNOM</li> </ul>"},{"location":"knowledgebase/mysql.html","title":"MariaDB","text":""},{"location":"knowledgebase/mysql.html#reset-root-password","title":"Reset root password","text":"<pre><code># run mariadb without authorization and network enabled\nsystemctl stop mariadb\nmysqld_safe --skip-grant-tables --skip-networking\n\n# use another terminal to update the password\nmysql -u root\nMariaDB&gt; UPDATE mysql.user SET password=PASSWORD(\"new_password\") where user='root';\nMariaDB&gt; FLUSH PRIVILEGES;\nMariaDB&gt; EXIT;\n\n# start normal mariadb\n$ mysqladmin shutdown\n$ systemctl start mariadb\n</code></pre>"},{"location":"knowledgebase/nftables.html","title":"nftables","text":"<p>Mit <code>nft -i</code> kann eine Interaktive Shell ge\u00f6ffnet werden. <code>list ruleset</code> zeigt die aktuelle Konfiguration an. Regeln k\u00f6nnen wie folgt eingef\u00fcgt werden: <pre><code># Source NAT\ntable ip nat { chain postrouting { oifname eth0 masquerade; }; }\n\n# Create new table\nadd table inet test\ntable test { chain example { }; }\n\n# Add rule\nadd rule test example oifname eth0 masquerade; \n\n# Delete Table\ndelete table inet test\n</code></pre> <code>flush ruleset</code> l\u00f6scht alle Regeln (Achtung: Auch NAT, dadurch kann die Verbindung verloren gehen!)</p> <p>Startet man die nft shell mit <code>-a</code> wird an jeder Regel ein unique identifier angegeben, der zum l\u00f6schen einzelner Regeln genutzt werden kann: <pre><code>nft -a list ruleset\ndelete rule &lt;table&gt; &lt;chain&gt; handle &lt;n&gt;\n</code></pre></p>"},{"location":"knowledgebase/openssl.html","title":"OpenSSL","text":""},{"location":"knowledgebase/openssl.html#create-certificate-authority-ca","title":"Create certificate authority (ca)","text":"<ol> <li> <p>Create private key</p> RSAECDSAED25519 <pre><code># with passphrase\nopenssl genrsa -aes256 -passout pass:{password} -out ca.key 8192\n\n# without passphrase\nopenssl genrsa -out ca.key 8192\n</code></pre> <pre><code>openssl ecparam -name prime256v1 -genkey -noout -out ca.key\n</code></pre> <pre><code># with passphrase\nopenssl genpkey -algorithm ED25519 -aes256 -pass pass:{password} -out ca.key\n\n# without passphrase\nopenssl genpkey -algorithm ED25519 -out ca.key\n</code></pre> </li> <li> <p>Create certificate</p> <pre><code>openssl req -x509 -sha512 -subj /CN=ca -new -days 1 -noenc -extensions v3_ca -key ca.key -out ca.pem\n</code></pre> </li> </ol>"},{"location":"knowledgebase/openssl.html#create-tls-server-certificate","title":"Create tls server certificate","text":"<ol> <li> <p>Create private key</p> RSAECDSAED25519 <pre><code># with passphrase\nopenssl genrsa -aes256 -passout pass:{password} -out server.key 8192\n\n# without passphrase\nopenssl genrsa -out server.key 8192\n</code></pre> <pre><code>openssl ecparam -name prime256v1 -genkey -noout -out server.key\n</code></pre> <pre><code># with passphrase\nopenssl genpkey -algorithm ED25519 -aes256 -pass pass:{password} -out server.key\n\n# without passphrase\nopenssl genpkey -algorithm ED25519 -out server.key\n</code></pre> </li> <li> <p>Create certificate</p> <pre><code># selfsigned\nopenssl req -x509 -sha512 -subj /CN=server -new -days 1 -key server.key -out server.pem\n\n# ca signed\nopenssl req -sha512 -subj /CN=server -new -key server.key -out server.csr\nopenssl x509 -sha512 -req -in server.csr -days 1 -CA ca.pem -CAkey ca.key -out server.crt\n</code></pre> <p>You can also add subjectAltNames: <pre><code>openssl x509 -sha512 -req -in server.csr -days 1 -CA ca.pem -CAkey ca.key -out server.crt \\\n  -extfile &lt;(echo 'subjectAltName = DNS:example.com')\n</code></pre></p> </li> </ol> <p>Verification of certificate chain</p> <p>If you signed your certificate with a CA, you can verify the chain using: <pre><code>openssl verify -CAfile ca.pem server.pem\n</code></pre></p>"},{"location":"knowledgebase/openssl.html#converting-keys","title":"Converting keys","text":""},{"location":"knowledgebase/openssl.html#pem-to-crt","title":"<code>.pem</code> to <code>.crt</code>","text":"<pre><code>openssl x509 -in ca.pem -outform der -out ca.crt\n</code></pre>"},{"location":"knowledgebase/openssl.html#p12-pkcs12-keystore-container","title":"<code>.p12</code> (pkcs12 keystore container)","text":"<pre><code># combind private key and x509 certificate to pkcs12 keystore container\nopenssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 -name client\n</code></pre>"},{"location":"knowledgebase/openssl.html#extract-files-from-p12-pkcs12-keystore-container","title":"Extract files from <code>.p12</code> (pkcs12 keystore container)","text":"<pre><code># extract ca certificate\nopenssl pkcs12 -in filename.p12 -out newfile.ca.crt.pem -cacerts -nokeys -chain\n\n# extract certificate\nopenssl pkcs12 -in filename.p12 -out newfile.crt.pem -clcerts -nokeys\n\n# extract private key\nopenssl pkcs12 -in filename.p12 -out newfile.key.pem -nocerts -nodes\n</code></pre>"},{"location":"knowledgebase/openssl.html#extract-smime-certificate-from-signed-email","title":"Extract s/mime certificate from signed email","text":"<ol> <li>Export signed message from Evolution as mbox file (context menu -&gt; save as file)</li> <li>Extract smime.p7s from .mbox file and add PKCS7 header    <pre><code>-----BEGIN PKCS7-----\nMIAGCSqGSIb3DQEHAqCAMIACAQExDzANBglghkgBZQMEAgMFADCABgkqhkiG9w0BBwEAAKCAMIIH\nVjCCBT6gAwIBAgIDSRKYMA0GCSqGSIb3DQEBCwUAMFwxCzAJBgNVBAYTAkRFMRkwFwYDVQQKExBQ\nS0ktMS1WZXJ3YWx0dW5nMRMwEQYDVQQLEwpCdW5kZXN3ZWhyMR0wGwYDVQQDExRCdyBWLVBLSSBD\n...\nItC1Jda7G3OItYH1shivhFNKOOK1gSDErsuY8wgLwIExtKEKDhcum2ivwu2Hy0L0/wm5gzG1dUj6\n1iUYZDDXfQAAAAAAAA==\n-----END PKCS7-----\n</code></pre></li> <li>Export certificate from PKCS7 container    <pre><code>openssl pkcs7 -print_certs -in smime.p7s -out smime.cer\n</code></pre></li> </ol>"},{"location":"knowledgebase/openssl.html#symmetric-encryptiondecryption","title":"Symmetric Encryption/Decryption","text":"<pre><code>openssl enc -e -a -pbkdf2 -aes-256-ofb -in plain.txt -out cipher.txt\nopenssl enc -d -a -pbkdf2 -aes-256-ofb -in cipher.txt -out plain.txt\n</code></pre>"},{"location":"knowledgebase/rpi.html","title":"Raspberry PI","text":"<ul> <li>pinout.xyz</li> <li>RaspberryPI OS</li> </ul>"},{"location":"knowledgebase/rpi.html#image-selection","title":"Image Selection","text":"<p>RPi 3, 4, zero 2w: arm64 all other models: armhf</p>"},{"location":"knowledgebase/rpi.html#setup","title":"Setup","text":"<pre><code># navigate to boot partition of the image\ncd /media/$USER/boot/\n\n# enable ssh\ntouch ssh\n\n# create user nicof2000\necho \"username:$(mkpasswd)\" &gt; userconf\n\n# connect to wifi (optional)\ncat &lt;&lt;_EOF &gt; wpa_supplicant.conf\nnetwork={\n    ssid=\"SSID\"\n    psk=WPA_PASSPHRASE\n}\n_EOF\n</code></pre>"},{"location":"knowledgebase/rpi.html#runtime","title":"Runtime","text":""},{"location":"knowledgebase/rpi.html#disable-leds","title":"Disable LEDs","text":"<p>Add the following two lines to the file: <code>/boot/config.txt</code> <pre><code>dtparam=act_led_trigger=none\ndtparam=act_led_activelow=on\n</code></pre></p>"},{"location":"knowledgebase/rpi.html#set-the-pi-zero-act-led-trigger-to-none","title":"Set the Pi Zero ACT LED trigger to \"none\"","text":"<pre><code>echo none | sudo tee /sys/class/leds/led0/trigger\n</code></pre>"},{"location":"knowledgebase/rpi.html#turn-off-the-pi-zero-act-led","title":"Turn off the Pi Zero ACT LED","text":"<pre><code>echo 1 | sudo tee /sys/class/leds/led0/brightness\n</code></pre>"},{"location":"knowledgebase/rpi.html#set-yellow-led-to-mmc0-and-red-led-to-heartbeat","title":"Set yellow LED to \"mmc0\" and red LED to \"heartbeat\"","text":"<pre><code>echo mmc0      | sudo tee /sys/class/leds/led0/trigger\necho heartbeat | sudo tee /sys/class/leds/led1/trigger\n</code></pre>"},{"location":"knowledgebase/rpi.html#reset-yello-and-red-led","title":"Reset yello and red led","text":"<pre><code>echo mmc0  | sudo tee /sys/class/leds/led0/trigger\necho input | sudo tee /sys/class/leds/led1/trigger\n</code></pre>"},{"location":"knowledgebase/rpi.html#gpio-shutdown","title":"GPIO Shutdown","text":"<p>Restart: Connect the GPIO Pins 5 and 6 for one second. Shutdown: Connect the GPIO Pins 5 and 6 for five seconds. <pre><code>sudo wget -O /usr/local/bin/pishutdown.py http://raw.githubusercontent.com/gilyes/pi-shutdown/master/pishutdown.py\nsudo git clone https://github.com/gilyes/pi-shutdown .\nsudo cp 1722-144/pishutdown/* /etc/systemd/system\nsudo systemctl enable pishutdown\nsudo rm -rf pi-shutdown\n</code></pre></p>"},{"location":"knowledgebase/rpi.html#wifi-access-point","title":"WiFi Access Point","text":"<pre><code># configure network in /etc/network/interfaces:\nallow-hotplug &lt;wlan1&gt;\niface &lt;wlan1&gt; inet static\n    wireless-power off\n    address &lt;ip&gt;\n    netmask &lt;netmask&gt;\n\n# setup hostapd\ncat &lt;&lt;_EOF &gt; /etc/hostapd/hostapd.conf:\ndriver=nl80211\nctrl_interface=/var/run/hostapd\nctrl_interface_group=0\nbeacon_int=100\nauth_algs=1\nwpa_key_mgmt=WPA-PSK\nssid=&lt;ESSID&gt;\nchannel=4\nhw_mode=g\nwpa_passphrase=&lt;PASSWORD&gt;\nrsn_pairwise=CCMP\ninterface=wlan0\nwpa=2\ncountry_code=DE\nieee80211n=1\n_EOF\n\nchmod 600 /etc/hostapd/hostapd.conf\n\n# add to /etc/default/hostapd:\nDAEMON_CONF=\"/etc/hostapd/hostapd.conf\"\n</code></pre>"},{"location":"knowledgebase/rpi.html#dhcp-server","title":"DHCP Server","text":"<pre><code>cat &lt;&lt;_EOF &gt;&gt; /etc/dnsmasq.conf\ninterface=wlan1\ndhcp-range=172.25.25.10,172.25.25.100,24,3h\ndhcp-option=3,172.25.25.1\n_EOF\n</code></pre>"},{"location":"knowledgebase/rpi.html#udev-bind-network-device-to-specific-name","title":"udev: Bind network device to specific name","text":"<pre><code># Deactivate \"predictable naming\" (default on RPI):\nln -s /dev/null /etc/systemd/network/99-default.link\n\n# Add driver to /etc/udev/rules.d/72-static-name.rules (find drivername via \"dmesg | grep -i usbcore\"):\ncat &lt;&lt;_EOF &gt; /etc/udev/rules.d/72-static-name.rules\nACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"brcmfmac\",  NAME=\"wlan0\"\nACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"rt2800usb\", NAME=\"wlan1\"\nACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"rtl8192cu\", NAME=\"wlan2\"\n_EOF\n\n# Or add Mac to /etc/udev/rules.d/72-static-name.rules:\ncat &lt;&lt;_EOF &gt; /etc/udev/rules.d/72-static-name.rules\nACTION==\"add\", SUBSYSTEM==\"net\", ATTR{address}==\"aa:bb:cc:dd:ee.ff\", NAME=\"eth0\"\nACTION==\"add\", SUBSYSTEM==\"net\", ATTR{address}==\"aa:bb:cc:dd:ee.ff\", NAME=\"wlan1\"\nACTION==\"add\", SUBSYSTEM==\"net\", ATTR{address}==\"aa:bb:cc:dd:ee.ff\", NAME=\"wlan0\"\n_EOF\n</code></pre>"},{"location":"knowledgebase/rpi.html#raspbian-10-buster","title":"Raspbian 10 (Buster)","text":"<p>Wifi wont connect because <code>/etc/networks/interfaces</code> does not exist: <pre><code>auto lo\niface lo inet loopback\nauto wlan0\nallow-hotplug wlan0\niface wlan0 inet dhcp\n  wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf\n</code></pre></p>"},{"location":"knowledgebase/rpi.html#ndis","title":"NDIS","text":"<p>see: https://learn.adafruit.com/turning-your-raspberry-pi-zero-into-a-usb-gadget/ethernet-gadget <pre><code># add to config.txt\ndtoverlay=dwc2\n</code></pre> <pre><code># add after rootwait in cmdline.txt\nmodules-load=dwc2,g_ether\n</code></pre></p>"},{"location":"knowledgebase/ssh.html","title":"SSH","text":""},{"location":"knowledgebase/ssh.html#remote-port-forwarding","title":"Remote Port Forwarding","text":"<p>If you want to expose a local port (from your local machine) on a remote machine, that's reachable beyond localhost, <code>GatewayPorts</code> must be allowed in the server configuration.</p>"},{"location":"knowledgebase/ssh.html#only-allow-the-use-of-port-forwardings","title":"Only allow the use of port forwardings","text":"<p>By specifying <code>ForceCommand echo</code> in the server configuration, you can remove the ability to execute commands from the clients.</p>"},{"location":"knowledgebase/ssh.html#unattended-ssh-for-port-fowardings","title":"Unattended SSH (for Port Fowardings)","text":"<p>You can configure your SSH client to exclusively manage port forwarding without initiating a shell prompt by utilizing the following options: <code>-fCqN</code></p> <ul> <li><code>-f</code>: Forks the process to the background</li> <li><code>-C</code>: Compresses the data before sending it</li> <li><code>-q</code>: Uses quiet mode</li> <li><code>-N</code>: Tells SSH that no command will be sent once the tunnel is up</li> </ul>"},{"location":"knowledgebase/udev.html","title":"udev","text":"<p>You can hide partitions (e. g. the Windows Boot Partition) from your file manager using a simple udev rule: <pre><code># get uuid of partition you want to hide\npart_dev=/dev/sdb1\npart_id=$(sudo udevadm info --query=all -n ${part_dev} | grep ID_PART_ENTRY_UUID | cut -d= -f2)\n\n# create udev rule\necho 'ENV{ID_PART_ENTRY_UUID}==\"'${part_id}'\", ENV{UDISKS_IGNORE}=\"1\"' | sudo tee -a /etc/udev/rules.d/99-unplug-boot.rules\n\n# apply the created rule\nsudo udevadm control --reload-rules &amp;&amp; sudo udevadm trigger\n</code></pre></p>"},{"location":"knowledgebase/windows.html","title":"Windows","text":""},{"location":"knowledgebase/windows.html#reinstall-boot-manager","title":"Reinstall Boot Manager","text":"<p>These instructions also work if: - Bitlocker is activated - the EFI partition is not displayed as a volume.</p> <ol> <li> <p>Delete EFI partition using <code>diskpart</code>:    <pre><code>REM select correct disk (replace x with the id of the disk)\nlist disk\nsel disk X\nREM select efi partition (replace n with the id of the efi partition)\nlist part\nsel part N\nREM delete efi partition\ndel part override\n</code></pre></p> </li> <li> <p>Create new EFI partition using <code>diskpart</code>:    <pre><code>REM create efi system partition\ncreate partition EFI size=200\nREM format partition as fat32\nformat quick fs=fat32 label=\"System\"\n</code></pre>    If more disk space is required to create the fat32 system (16 MB is not enough!), the C: partition can be reduced in size:    <pre><code>REM select C:\\ (replace n with the id of the root partition (probally the largest one))\nlist part\nsel part N\nREM create more free space (200mb)\nshrink desired=200\n</code></pre></p> </li> <li> <p>Assign letter for EFI partition using <code>diskpart</code>:    <pre><code>REM select efi partition (replace n with the id of the efi partition)\nlist vol\nsel vol N\nassign letter Y:\n</code></pre></p> </li> <li> <p>Reinstall Bootloader    <pre><code>bootrec /rebuildbcd\nbootrec /fixmbr\nbootrec /fixboot  # works even if you get access denied...\nbcdboot c:\\Windows /s Y: /f ALL\n</code></pre></p> </li> <li> <p>Reboot</p> </li> </ol>"},{"location":"blog/category/grapheneos.html","title":"GrapheneOS","text":""},{"location":"blog/category/nixos.html","title":"NixOS","text":""},{"location":"blog/category/networking.html","title":"Networking","text":""}]}